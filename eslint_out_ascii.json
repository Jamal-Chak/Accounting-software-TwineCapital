[{"filePath":"C:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\analytics\\health\\page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":69,"column":88,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[2585,2643],"text":"AI-driven analysis of your company&apos;s financial performance"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[2585,2643],"text":"AI-driven analysis of your company&lsquo;s financial performance"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[2585,2643],"text":"AI-driven analysis of your company&#39;s financial performance"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[2585,2643],"text":"AI-driven analysis of your company&rsquo;s financial performance"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport Link from 'next/link'\r\nimport { HealthScore } from '@/lib/health'\r\n\r\nexport default function HealthScoreDashboard() {\r\n    const [health, setHealth] = useState<HealthScore | null>(null)\r\n    const [loading, setLoading] = useState(true)\r\n    const [error, setError] = useState<string | null>(null)\r\n\r\n    useEffect(() => {\r\n        fetchData()\r\n    }, [])\r\n\r\n    const fetchData = async () => {\r\n        try {\r\n            const response = await fetch('/api/analytics/health')\r\n            const result = await response.json()\r\n\r\n            if (result.success) {\r\n                setHealth(result.data)\r\n            } else {\r\n                setError(result.error || 'Failed to load health data')\r\n            }\r\n        } catch (err) {\r\n            setError('Network error')\r\n        } finally {\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    const getScoreColor = (score: number) => {\r\n        if (score >= 80) return 'text-green-600'\r\n        if (score >= 60) return 'text-yellow-600'\r\n        return 'text-red-600'\r\n    }\r\n\r\n    const getScoreBg = (score: number) => {\r\n        if (score >= 80) return 'bg-green-100'\r\n        if (score >= 60) return 'bg-yellow-100'\r\n        return 'bg-red-100'\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50\">\r\n            {/* Header */}\r\n            <header className=\"bg-white border-b border-gray-200\">\r\n                <div className=\"px-8 py-4\">\r\n                    <h1 className=\"text-2xl font-bold text-gray-900\">TwineCapital</h1>\r\n                    <p className=\"text-gray-600\">Accounting, Intelligently Engineered</p>\r\n                </div>\r\n            </header>\r\n\r\n            {/* Navigation */}\r\n            <nav className=\"bg-white border-b border-gray-200\">\r\n                <div className=\"px-8 py-3 flex space-x-6\">\r\n                    <Link href=\"/dashboard\" className=\"text-gray-600 hover:text-gray-900\">Dashboard</Link>\r\n                    <Link href=\"/analytics/cashflow\" className=\"text-gray-600 hover:text-gray-900\">Cashflow</Link>\r\n                    <span className=\"text-blue-600 font-medium border-b-2 border-blue-600 pb-1\">Health Score</span>\r\n                </div>\r\n            </nav>\r\n\r\n            {/* Main Content */}\r\n            <main className=\"p-8\">\r\n                <div className=\"max-w-6xl mx-auto\">\r\n                    <div className=\"mb-8\">\r\n                        <h2 className=\"text-3xl font-bold text-gray-900\">Business Health Score</h2>\r\n                        <p className=\"text-gray-600\">AI-driven analysis of your company's financial performance</p>\r\n                    </div>\r\n\r\n                    {error && (\r\n                        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 mb-6\">\r\n                            <p className=\"text-red-800\">{error}</p>\r\n                        </div>\r\n                    )}\r\n\r\n                    {loading ? (\r\n                        <div className=\"flex justify-center py-12\">\r\n                            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n                        </div>\r\n                    ) : health && (\r\n                        <>\r\n                            {/* Hero Score Card */}\r\n                            <div className=\"bg-white rounded-xl border border-gray-200 shadow-sm p-8 mb-8 flex items-center justify-between\">\r\n                                <div>\r\n                                    <h3 className=\"text-lg font-medium text-gray-500 mb-2\">Overall Health Score</h3>\r\n                                    <div className=\"flex items-baseline gap-4\">\r\n                                        <span className={`text-6xl font-bold ${getScoreColor(health.totalScore)}`}>\r\n                                            {health.totalScore}\r\n                                        </span>\r\n                                        <span className=\"text-gray-400 text-xl\">/ 100</span>\r\n                                    </div>\r\n                                    <p className=\"text-gray-600 mt-2\">\r\n                                        {health.totalScore >= 80 ? 'Excellent! Your business is thriving.' :\r\n                                            health.totalScore >= 60 ? 'Good. Some areas need attention.' :\r\n                                                'Needs Improvement. Action required.'}\r\n                                    </p>\r\n                                </div>\r\n\r\n                                {/* Circular Progress Placeholder */}\r\n                                <div className=\"relative w-32 h-32\">\r\n                                    <svg className=\"w-full h-full\" viewBox=\"0 0 36 36\">\r\n                                        <path\r\n                                            d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"\r\n                                            fill=\"none\"\r\n                                            stroke=\"#eee\"\r\n                                            strokeWidth=\"3\"\r\n                                        />\r\n                                        <path\r\n                                            d=\"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831\"\r\n                                            fill=\"none\"\r\n                                            stroke={health.totalScore >= 80 ? '#16a34a' : health.totalScore >= 60 ? '#ca8a04' : '#dc2626'}\r\n                                            strokeWidth=\"3\"\r\n                                            strokeDasharray={`${health.totalScore}, 100`}\r\n                                        />\r\n                                    </svg>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Pillars Grid */}\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\r\n                                {/* Profitability */}\r\n                                <div className=\"bg-white p-6 rounded-lg border border-gray-200 shadow-sm\">\r\n                                    <div className=\"flex justify-between items-start mb-4\">\r\n                                        <h4 className=\"font-semibold text-gray-900\">Profitability</h4>\r\n                                        <span className={`px-2 py-1 rounded text-xs font-medium ${getScoreBg(health.pillars.profitability.score)} ${getScoreColor(health.pillars.profitability.score)}`}>\r\n                                            {health.pillars.profitability.score}/100\r\n                                        </span>\r\n                                    </div>\r\n                                    <div className=\"space-y-3\">\r\n                                        <div className=\"flex justify-between text-sm\">\r\n                                            <span className=\"text-gray-500\">Net Margin</span>\r\n                                            <span className=\"font-medium\">{health.pillars.profitability.metrics.netMargin.toFixed(1)}%</span>\r\n                                        </div>\r\n                                        <div className=\"flex justify-between text-sm\">\r\n                                            <span className=\"text-gray-500\">Gross Margin</span>\r\n                                            <span className=\"font-medium\">{health.pillars.profitability.metrics.grossMargin.toFixed(1)}%</span>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Liquidity */}\r\n                                <div className=\"bg-white p-6 rounded-lg border border-gray-200 shadow-sm\">\r\n                                    <div className=\"flex justify-between items-start mb-4\">\r\n                                        <h4 className=\"font-semibold text-gray-900\">Liquidity</h4>\r\n                                        <span className={`px-2 py-1 rounded text-xs font-medium ${getScoreBg(health.pillars.liquidity.score)} ${getScoreColor(health.pillars.liquidity.score)}`}>\r\n                                            {health.pillars.liquidity.score}/100\r\n                                        </span>\r\n                                    </div>\r\n                                    <div className=\"space-y-3\">\r\n                                        <div className=\"flex justify-between text-sm\">\r\n                                            <span className=\"text-gray-500\">Current Ratio</span>\r\n                                            <span className=\"font-medium\">{health.pillars.liquidity.metrics.currentRatio.toFixed(2)}x</span>\r\n                                        </div>\r\n                                        <div className=\"flex justify-between text-sm\">\r\n                                            <span className=\"text-gray-500\">Quick Ratio</span>\r\n                                            <span className=\"font-medium\">{health.pillars.liquidity.metrics.quickRatio.toFixed(2)}x</span>\r\n                                        </div>\r\n                                        <div className=\"flex justify-between text-sm\">\r\n                                            <span className=\"text-gray-500\">Cash Runway</span>\r\n                                            <span className=\"font-medium\">{health.pillars.liquidity.metrics.cashRunway.toFixed(1)} mo</span>\r\n                                        </div>\r\n                                        <div className=\"flex justify-between text-sm\">\r\n                                            <span className=\"text-gray-500\">Working Capital</span>\r\n                                            <span className={`font-medium ${health.pillars.liquidity.metrics.workingCapital >= 0 ? 'text-green-600' : 'text-red-600'}`}>\r\n                                                R{health.pillars.liquidity.metrics.workingCapital.toLocaleString()}\r\n                                            </span>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Efficiency */}\r\n                                <div className=\"bg-white p-6 rounded-lg border border-gray-200 shadow-sm\">\r\n                                    <div className=\"flex justify-between items-start mb-4\">\r\n                                        <h4 className=\"font-semibold text-gray-900\">Efficiency</h4>\r\n                                        <span className={`px-2 py-1 rounded text-xs font-medium ${getScoreBg(health.pillars.efficiency.score)} ${getScoreColor(health.pillars.efficiency.score)}`}>\r\n                                            {health.pillars.efficiency.score}/100\r\n                                        </span>\r\n                                    </div>\r\n                                    <div className=\"space-y-3\">\r\n                                        <div className=\"flex justify-between text-sm\">\r\n                                            <span className=\"text-gray-500\">AR Overdue</span>\r\n                                            <span className=\"font-medium\">{health.pillars.efficiency.metrics.arAging.toFixed(1)}%</span>\r\n                                        </div>\r\n                                        <div className=\"pl-2 space-y-1 border-l-2 border-gray-200\">\r\n                                            <div className=\"flex justify-between text-xs\">\r\n                                                <span className=\"text-gray-400\">0-30 days</span>\r\n                                                <span className=\"text-gray-600\">R{health.pillars.efficiency.metrics.arAging30.toLocaleString()}</span>\r\n                                            </div>\r\n                                            <div className=\"flex justify-between text-xs\">\r\n                                                <span className=\"text-gray-400\">31-60 days</span>\r\n                                                <span className=\"text-orange-600\">R{health.pillars.efficiency.metrics.arAging60.toLocaleString()}</span>\r\n                                            </div>\r\n                                            <div className=\"flex justify-between text-xs\">\r\n                                                <span className=\"text-gray-400\">90+ days</span>\r\n                                                <span className=\"text-red-600\">R{health.pillars.efficiency.metrics.arAging90Plus.toLocaleString()}</span>\r\n                                            </div>\r\n                                        </div>\r\n                                        <div className=\"flex justify-between text-sm\">\r\n                                            <span className=\"text-gray-500\">DSO (Days)</span>\r\n                                            <span className=\"font-medium\">{Math.round(health.pillars.efficiency.metrics.dso)} days</span>\r\n                                        </div>\r\n                                        <div className=\"flex justify-between text-sm\">\r\n                                            <span className=\"text-gray-500\">Expense Ratio</span>\r\n                                            <span className=\"font-medium\">{health.pillars.efficiency.metrics.expenseRatio.toFixed(1)}%</span>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Growth */}\r\n                                <div className=\"bg-white p-6 rounded-lg border border-gray-200 shadow-sm\">\r\n                                    <div className=\"flex justify-between items-start mb-4\">\r\n                                        <h4 className=\"font-semibold text-gray-900\">Growth</h4>\r\n                                        <span className={`px-2 py-1 rounded text-xs font-medium ${getScoreBg(health.pillars.growth.score)} ${getScoreColor(health.pillars.growth.score)}`}>\r\n                                            {health.pillars.growth.score}/100\r\n                                        </span>\r\n                                    </div>\r\n                                    <div className=\"space-y-3\">\r\n                                        <div className=\"flex justify-between text-sm\">\r\n                                            <span className=\"text-gray-500\">Revenue Growth</span>\r\n                                            <span className=\"font-medium\">+{health.pillars.growth.metrics.revenueGrowth}%</span>\r\n                                        </div>\r\n                                        <div className=\"w-full bg-gray-100 rounded-full h-1.5 mt-2\">\r\n                                            <div className=\"bg-blue-600 h-1.5 rounded-full\" style={{ width: '60%' }}></div>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Recommendations */}\r\n                            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-6\">\r\n                                <h3 className=\"text-lg font-semibold text-blue-900 mb-4 flex items-center gap-2\">\r\n                                    <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                                    </svg>\r\n                                    AI Recommendations\r\n                                </h3>\r\n                                <ul className=\"space-y-3\">\r\n                                    {health.recommendations.map((rec, idx) => (\r\n                                        <li key={idx} className=\"flex items-start gap-3 bg-white p-4 rounded-lg border border-blue-100 shadow-sm\">\r\n                                            <div className=\"flex-shrink-0 mt-0.5\">\r\n                                                <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold ${rec.priority === 'critical' ? 'bg-red-100 text-red-800' :\r\n                                                        rec.priority === 'high' ? 'bg-orange-100 text-orange-800' :\r\n                                                            rec.priority === 'medium' ? 'bg-yellow-100 text-yellow-800' :\r\n                                                                'bg-green-100 text-green-800'\r\n                                                    }`}>\r\n                                                    {rec.priority.toUpperCase()}\r\n                                                </span>\r\n                                            </div>\r\n                                            <div className=\"flex-1\">\r\n                                                <div className=\"text-xs text-gray-500 mb-1\">{rec.category}</div>\r\n                                                <p className=\"text-gray-700 text-sm\">{rec.message}</p>\r\n                                            </div>\r\n                                        </li>\r\n                                    ))}\r\n                                </ul>\r\n                            </div>\r\n                        </>\r\n                    )}\r\n                </div>\r\n            </main>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\apps\\ecommerce\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\apps\\ecommerce\\page.tsx:22:17\n  20 |             try {\n  21 |                 const connections = JSON.parse(savedState)\n> 22 |                 setPlatforms(prev => prev.map(p => ({\n     |                 ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  23 |                     ...p,\n  24 |                     status: connections[p.id] ? 'Connected' : 'Not Connected',\n  25 |                     lastSync: connections[p.id] ? 'Just now' : '-'","line":22,"column":17,"nodeType":null,"endLine":22,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { PageHeader } from '@/components/layout/PageHeader'\r\nimport { ShoppingCart, RefreshCw, CheckCircle, ArrowRight, ExternalLink } from 'lucide-react'\r\nimport { useState, useEffect } from 'react'\r\nimport Link from 'next/link'\r\n\r\nexport default function EcommerceSyncPage() {\r\n    const [platforms, setPlatforms] = useState([\r\n        { id: 'shopify', name: 'Shopify', status: 'Connected', lastSync: '10 mins ago', icon: '/logos/shopify.svg' }, // Using text fallback if icon missing\r\n        { id: 'woocommerce', name: 'WooCommerce', status: 'Not Connected', lastSync: '-', icon: '/logos/woo.svg' },\r\n        { id: 'magento', name: 'Magento', status: 'Not Connected', lastSync: '-', icon: '/logos/magento.svg' },\r\n    ])\r\n    const [syncing, setSyncing] = useState(false)\r\n\r\n    // Load connection status\r\n    useEffect(() => {\r\n        const savedState = localStorage.getItem('ecommerce_connections')\r\n        if (savedState) {\r\n            try {\r\n                const connections = JSON.parse(savedState)\r\n                setPlatforms(prev => prev.map(p => ({\r\n                    ...p,\r\n                    status: connections[p.id] ? 'Connected' : 'Not Connected',\r\n                    lastSync: connections[p.id] ? 'Just now' : '-'\r\n                })))\r\n            } catch (e) { console.error(e) }\r\n        }\r\n    }, [])\r\n\r\n    const toggleConnection = (id: string) => {\r\n        setPlatforms(prev => {\r\n            const newPlatforms = prev.map(p => {\r\n                if (p.id === id) {\r\n                    return { ...p, status: p.status === 'Connected' ? 'Not Connected' : 'Connected', lastSync: 'Just now' }\r\n                }\r\n                return p\r\n            })\r\n\r\n            // Save state\r\n            const state = newPlatforms.reduce((acc, p) => ({ ...acc, [p.id]: p.status === 'Connected' }), {})\r\n            localStorage.setItem('ecommerce_connections', JSON.stringify(state))\r\n\r\n            return newPlatforms\r\n        })\r\n    }\r\n\r\n    const handleSync = () => {\r\n        setSyncing(true)\r\n        setTimeout(() => setSyncing(false), 2000)\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <PageHeader\r\n                title=\"E-commerce Sync\"\r\n                description=\"Connect your online stores to automatically import orders, inventory, and refunds.\"\r\n                breadcrumbs={[\r\n                    { label: 'Marketplace', href: '/marketplace' },\r\n                    { label: 'E-commerce Sync' }\r\n                ]}\r\n            />\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                {/* Main Content */}\r\n                <div className=\"lg:col-span-2 space-y-6\">\r\n                    {/* Active Connections */}\r\n                    <div className=\"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden\">\r\n                        <div className=\"p-6 border-b border-gray-200 flex justify-between items-center\">\r\n                            <h2 className=\"text-lg font-semibold text-gray-900\">Connected Stores</h2>\r\n                            <button\r\n                                onClick={handleSync}\r\n                                disabled={syncing}\r\n                                className=\"flex items-center gap-2 text-sm text-blue-600 hover:text-blue-700 font-medium disabled:opacity-50\"\r\n                            >\r\n                                <RefreshCw className={`w-4 h-4 ${syncing ? 'animate-spin' : ''}`} />\r\n                                {syncing ? 'Syncing...' : 'Sync Now'}\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"divide-y divide-gray-200\">\r\n                            {platforms.filter(p => p.status === 'Connected').map(platform => (\r\n                                <div key={platform.id} className=\"p-6 flex items-center justify-between\">\r\n                                    <div className=\"flex items-center gap-4\">\r\n                                        <div className=\"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center\">\r\n                                            <ShoppingCart className=\"w-6 h-6 text-gray-400\" />\r\n                                        </div>\r\n                                        <div>\r\n                                            <h3 className=\"font-semibold text-gray-900\">{platform.name}</h3>\r\n                                            <p className=\"text-sm text-green-600 flex items-center gap-1\">\r\n                                                <CheckCircle className=\"w-3 h-3\" />\r\n                                                Active ??? Last synced {platform.lastSync}\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n                                    <button\r\n                                        onClick={() => toggleConnection(platform.id)}\r\n                                        className=\"text-sm text-gray-500 hover:text-red-600 font-medium\"\r\n                                    >\r\n                                        Disconnect\r\n                                    </button>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Available Integrations */}\r\n                    <div className=\"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden\">\r\n                        <div className=\"p-6 border-b border-gray-200\">\r\n                            <h2 className=\"text-lg font-semibold text-gray-900\">Available Integrations</h2>\r\n                        </div>\r\n                        <div className=\"divide-y divide-gray-200\">\r\n                            {platforms.filter(p => p.status !== 'Connected').map(platform => (\r\n                                <div key={platform.id} className=\"p-6 flex items-center justify-between\">\r\n                                    <div className=\"flex items-center gap-4\">\r\n                                        <div className=\"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center\">\r\n                                            <ShoppingCart className=\"w-6 h-6 text-gray-400\" />\r\n                                        </div>\r\n                                        <div>\r\n                                            <h3 className=\"font-semibold text-gray-900\">{platform.name}</h3>\r\n                                            <p className=\"text-sm text-gray-500\">\r\n                                                Connect your {platform.name} store\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n                                    <button\r\n                                        onClick={() => toggleConnection(platform.id)}\r\n                                        className=\"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50\"\r\n                                    >\r\n                                        Connect\r\n                                    </button>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Sidebar Stats */}\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"bg-blue-50 rounded-lg p-6 border border-blue-100\">\r\n                        <h3 className=\"font-semibold text-blue-900 mb-2\">Sync Summary</h3>\r\n                        <p className=\"text-sm text-blue-700 mb-4\">\r\n                            Your last sync imported 142 orders and updated 34 inventory items.\r\n                        </p>\r\n                        <div className=\"space-y-3\">\r\n                            <div className=\"flex justify-between text-sm\">\r\n                                <span className=\"text-blue-800\">Orders Today</span>\r\n                                <span className=\"font-medium text-blue-900\">24</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between text-sm\">\r\n                                <span className=\"text-blue-800\">Revenue Today</span>\r\n                                <span className=\"font-medium text-blue-900\">R8,450</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between text-sm\">\r\n                                <span className=\"text-blue-800\">Pending Refunds</span>\r\n                                <span className=\"font-medium text-blue-900\">2</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"bg-white rounded-lg p-6 border border-gray-200 shadow-sm\">\r\n                        <h3 className=\"font-semibold text-gray-900 mb-4\">Quick Actions</h3>\r\n                        <div className=\"space-y-2\">\r\n                            <Link href=\"/items\" className=\"flex items-center justify-between p-3 rounded-md hover:bg-gray-50 group\">\r\n                                <span className=\"text-sm text-gray-700 font-medium\">Manage Inventory</span>\r\n                                <ArrowRight className=\"w-4 h-4 text-gray-400 group-hover:text-blue-600\" />\r\n                            </Link>\r\n                            <Link href=\"/sales/invoices\" className=\"flex items-center justify-between p-3 rounded-md hover:bg-gray-50 group\">\r\n                                <span className=\"text-sm text-gray-700 font-medium\">View Sales Orders</span>\r\n                                <ArrowRight className=\"w-4 h-4 text-gray-400 group-hover:text-blue-600\" />\r\n                            </Link>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\apps\\whatsapp\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\apps\\whatsapp\\page.tsx:16:13\n  14 |         const saved = localStorage.getItem('whatsapp_connected')\n  15 |         if (saved === 'true') {\n> 16 |             setConnected(true)\n     |             ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  17 |             const savedPhone = localStorage.getItem('whatsapp_phone')\n  18 |             if (savedPhone) setPhoneNumber(savedPhone)\n  19 |         }","line":16,"column":13,"nodeType":null,"endLine":16,"endColumn":25},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":168,"column":41,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[9717,9760],"text":"\r\n                                        &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[9717,9760],"text":"\r\n                                        &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[9717,9760],"text":"\r\n                                        &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[9717,9760],"text":"\r\n                                        &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":168,"column":60,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[9778,9817],"text":"&quot;\r\n                                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[9778,9817],"text":"&ldquo;\r\n                                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[9778,9817],"text":"&#34;\r\n                                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[9778,9817],"text":"&rdquo;\r\n                                    "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { PageHeader } from '@/components/layout/PageHeader'\r\nimport { MessageSquare, Save, Smartphone, CheckCircle } from 'lucide-react'\r\nimport { useState, useEffect } from 'react'\r\n\r\nexport default function WhatsAppConnectPage() {\r\n    const [connected, setConnected] = useState(false)\r\n    const [loading, setLoading] = useState(false)\r\n    const [phoneNumber, setPhoneNumber] = useState('')\r\n\r\n    // Load state on mount\r\n    useEffect(() => {\r\n        const saved = localStorage.getItem('whatsapp_connected')\r\n        if (saved === 'true') {\r\n            setConnected(true)\r\n            const savedPhone = localStorage.getItem('whatsapp_phone')\r\n            if (savedPhone) setPhoneNumber(savedPhone)\r\n        }\r\n    }, [])\r\n\r\n    const handleConnect = () => {\r\n        setLoading(true)\r\n        // Simulate API call\r\n        setTimeout(() => {\r\n            setConnected(true)\r\n            setLoading(false)\r\n            localStorage.setItem('whatsapp_connected', 'true')\r\n            localStorage.setItem('whatsapp_phone', phoneNumber)\r\n        }, 1500)\r\n    }\r\n\r\n    const handleDisconnect = () => {\r\n        setConnected(false)\r\n        setPhoneNumber('')\r\n        localStorage.removeItem('whatsapp_connected')\r\n        localStorage.removeItem('whatsapp_phone')\r\n    }\r\n\r\n    const handleSendTest = () => {\r\n        if (!phoneNumber) return\r\n\r\n        // Sanitize phone number: remove +, spaces, dashes, parens\r\n        const cleanNumber = phoneNumber.replace(/[+\\s\\-()]/g, '')\r\n        const message = encodeURIComponent('Hello from TwineCapital! This is a test message to confirm your integration.')\r\n\r\n        window.open(`https://wa.me/${cleanNumber}?text=${message}`, '_blank')\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <PageHeader\r\n                title=\"WhatsApp Connect\"\r\n                description=\"Send invoices, reminders, and notifications via WhatsApp.\"\r\n                breadcrumbs={[\r\n                    { label: 'Marketplace', href: '/marketplace' },\r\n                    { label: 'WhatsApp Connect' }\r\n                ]}\r\n            />\r\n\r\n            <div className=\"max-w-3xl mx-auto space-y-6\">\r\n                {/* Connection Status Card */}\r\n                <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n                    <div className=\"flex items-center justify-between mb-6\">\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <div className={`p-3 rounded-full ${connected ? 'bg-green-100' : 'bg-gray-100'}`}>\r\n                                <MessageSquare className={`w-6 h-6 ${connected ? 'text-green-600' : 'text-gray-500'}`} />\r\n                            </div>\r\n                            <div>\r\n                                <h2 className=\"text-lg font-semibold text-gray-900\">Connection Status</h2>\r\n                                <p className=\"text-sm text-gray-500\">\r\n                                    {connected\r\n                                        ? 'Connected to WhatsApp Business API'\r\n                                        : 'Not connected. Link your business account to start sending messages.'}\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                        {connected && (\r\n                            <span className=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700\">\r\n                                <CheckCircle className=\"w-3 h-3\" />\r\n                                Active\r\n                            </span>\r\n                        )}\r\n                    </div>\r\n\r\n                    {!connected ? (\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                                    WhatsApp Business Number\r\n                                </label>\r\n                                <div className=\"relative\">\r\n                                    <Smartphone className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\r\n                                    <input\r\n                                        type=\"tel\"\r\n                                        placeholder=\"+1 234 567 8900\"\r\n                                        value={phoneNumber}\r\n                                        onChange={(e) => setPhoneNumber(e.target.value)}\r\n                                        className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent\"\r\n                                    />\r\n                                </div>\r\n                                <p className=\"mt-1 text-xs text-gray-500\">\r\n                                    Must be a valid phone number registered with WhatsApp Business.\r\n                                </p>\r\n                            </div>\r\n\r\n                            <button\r\n                                onClick={handleConnect}\r\n                                disabled={!phoneNumber || loading}\r\n                                className=\"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n                            >\r\n                                {loading ? 'Connecting...' : 'Connect WhatsApp Account'}\r\n                            </button>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"bg-green-50 border border-green-200 rounded-md p-4 flex items-center justify-between\">\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <div className=\"w-10 h-10 bg-white rounded-full flex items-center justify-center border border-green-200\">\r\n                                        <span className=\"text-green-600 font-bold text-sm\">TC</span>\r\n                                    </div>\r\n                                    <div>\r\n                                        <p className=\"text-sm font-medium text-green-900\">Connected to {phoneNumber}</p>\r\n                                        <p className=\"text-xs text-green-700\">TwineCapital Business Account</p>\r\n                                    </div>\r\n                                </div>\r\n                                <button\r\n                                    onClick={handleDisconnect}\r\n                                    className=\"text-sm text-red-600 hover:text-red-700 font-medium\"\r\n                                >\r\n                                    Disconnect\r\n                                </button>\r\n                            </div>\r\n\r\n                            <div className=\"flex justify-end\">\r\n                                <button\r\n                                    onClick={handleSendTest}\r\n                                    className=\"text-sm text-green-700 hover:text-green-800 font-medium flex items-center gap-1.5\"\r\n                                >\r\n                                    <MessageSquare className=\"w-4 h-4\" />\r\n                                    Send Test Message\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Templates Section */}\r\n                <div className={`transition-opacity duration-200 ${connected ? 'opacity-100' : 'opacity-50 pointer-events-none'}`}>\r\n                    <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\r\n                        <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Message Templates</h3>\r\n\r\n                        <div className=\"space-y-4\">\r\n                            {[\r\n                                { title: 'New Invoice', preview: 'Hi {{customer}}, here is your invoice #{{number}} for {{amount}}. View it here: {{link}}' },\r\n                                { title: 'Payment Reminder', preview: 'Reminder: Invoice #{{number}} is overdue. Please pay {{amount}} as soon as possible.' },\r\n                                { title: 'Payment Receipt', preview: 'Thank you for your payment of {{amount}}. Your receipt is available here: {{link}}' }\r\n                            ].map((template) => (\r\n                                <div key={template.title} className=\"border border-gray-200 rounded-lg p-4\">\r\n                                    <div className=\"flex items-center justify-between mb-2\">\r\n                                        <h4 className=\"font-medium text-sm text-gray-900\">{template.title}</h4>\r\n                                        <label className=\"relative inline-flex items-center cursor-pointer\">\r\n                                            <input type=\"checkbox\" defaultChecked className=\"sr-only peer\" />\r\n                                            <div className=\"w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-green-500 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-green-600\"></div>\r\n                                        </label>\r\n                                    </div>\r\n                                    <p className=\"text-sm text-gray-500 bg-gray-50 p-3 rounded-md italic\">\r\n                                        \"{template.preview}\"\r\n                                    </p>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n\r\n                        <div className=\"mt-6 flex justify-end\">\r\n                            <button className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-sm font-medium\">\r\n                                <Save className=\"w-4 h-4\" />\r\n                                Save Configuration\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\billing\\page.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadSubscription` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\billing\\page.tsx:28:9\n  26 |\n  27 |     useEffect(() => {\n> 28 |         loadSubscription()\n     |         ^^^^^^^^^^^^^^^^ `loadSubscription` accessed before it is declared\n  29 |     }, [])\n  30 |\n  31 |     const loadSubscription = async () => {\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\billing\\page.tsx:31:5\n  29 |     }, [])\n  30 |\n> 31 |     const loadSubscription = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 32 |         const supabase = createClient()\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 33 |\n     ???\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 78 |         }\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 79 |     }\n     | ^^^^^^ `loadSubscription` is declared here\n  80 |\n  81 |     const handleUpgrade = async (planId: string) => {\n  82 |         setLoading(true)","line":28,"column":9,"nodeType":null,"endLine":28,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { PRICING_PLANS, type PlanId } from '@/lib/pricing'\r\nimport { PricingCard } from '@/components/billing/PricingCard'\r\nimport { createClient } from '@/lib/auth/supabase-client'\r\nimport { Loader2, CreditCard, CheckCircle2, History } from 'lucide-react'\r\nimport { useRouter } from 'next/navigation'\r\n\r\n// Helper to safely access plans array\r\nconst plans = Object.values(PRICING_PLANS)\r\n\r\nexport default function BillingPage({\r\n    searchParams,\r\n}: {\r\n    searchParams: { [key: string]: string | string[] | undefined }\r\n}) {\r\n    const [loading, setLoading] = useState(false)\r\n    const [currentPlanId, setCurrentPlanId] = useState<string | null>(null)\r\n    const [subscriptionStatus, setSubscriptionStatus] = useState<string | null>(null)\r\n    const [trialEndsAt, setTrialEndsAt] = useState<string | null>(null)\r\n    const [companyId, setCompanyId] = useState<string | null>(null)\r\n\r\n    // Check payment status from URL\r\n    const paymentStatus = searchParams['payment'] as string\r\n\r\n    useEffect(() => {\r\n        loadSubscription()\r\n    }, [])\r\n\r\n    const loadSubscription = async () => {\r\n        const supabase = createClient()\r\n\r\n        // Get user company\r\n        const { data: { user } } = await supabase.auth.getUser()\r\n        if (!user) return\r\n\r\n        const { data: company } = await supabase\r\n            .from('companies')\r\n            .select('*, subscriptions(*)')\r\n            .eq('user_id', user.id)\r\n            .single()\r\n\r\n        if (company) {\r\n            setCompanyId(company.id)\r\n            if (company.subscriptions) {\r\n                // In a real app, you might have multiple subs, here we assume one active/trial\r\n                // The relationship might be one-to-many but let's take the latest\r\n                // Assuming 1:1 or we pick the relevant one. \r\n                // Based on schema, companies has subscription_id, or subscriptions has company_id\r\n                // Let's use the one linked in companies if exists, or query subscriptions table directly if needed.\r\n                // The schema from previous context suggested companies has subscription_id.\r\n                // But wait, the previous `verify` route updated `subscriptions` table.\r\n                // Let's fetch the subscription directly using company_id.\r\n\r\n                const { data: sub } = await supabase\r\n                    .from('subscriptions')\r\n                    .select('*, pricing_plans(*)')\r\n                    .eq('company_id', company.id)\r\n                    .single() // Assumption: one active sub per company\r\n\r\n                if (sub) {\r\n                    setSubscriptionStatus(sub.status)\r\n                    setTrialEndsAt(sub.trial_ends_at)\r\n                    // If we have a pricing plan linked\r\n                    if (sub.pricing_plans) {\r\n                        // Map database plan name/id to our local config\r\n                        // This part depends on how your DB `pricing_plans` name matches `lib/pricing` IDs.\r\n                        // Assuming `sub.pricing_plans.name` === 'starter' | 'professional' | 'enterprise'\r\n                        setCurrentPlanId(sub.pricing_plans.name.toLowerCase())\r\n                    } else if (sub.status === 'trial') {\r\n                        // Trial usually defaults to something or has no plan_id yet\r\n                        // For now, let's assume no plan selected implies 'starter' trial or similar\r\n                        // Or just null\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    const handleUpgrade = async (planId: string) => {\r\n        setLoading(true)\r\n        try {\r\n            const response = await fetch('/api/subscription/checkout', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ planId }),\r\n            })\r\n\r\n            const data = await response.json()\r\n\r\n            if (data.success && data.payment_link) {\r\n                // Redirect to Flutterwave\r\n                window.location.href = data.payment_link\r\n            } else {\r\n                alert(data.error || 'Failed to initiate checkout')\r\n                setLoading(false)\r\n            }\r\n        } catch (error) {\r\n            console.error('Checkout error:', error)\r\n            alert('An unexpected error occurred')\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-8\">\r\n\r\n            {/* Payment Feedback */}\r\n            {paymentStatus === 'success' && (\r\n                <div className=\"bg-green-50 border border-green-200 rounded-lg p-4 flex items-center gap-3 text-green-800\">\r\n                    <CheckCircle2 className=\"w-5 h-5\" />\r\n                    <div>\r\n                        <h4 className=\"font-medium\">Payment Successful!</h4>\r\n                        <p className=\"text-sm\">Your subscription has been updated.</p>\r\n                    </div>\r\n                </div>\r\n            )}\r\n            {paymentStatus === 'failed' && (\r\n                <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center gap-3 text-red-800\">\r\n                    <CreditCard className=\"w-5 h-5\" />\r\n                    <div>\r\n                        <h4 className=\"font-medium\">Payment Failed</h4>\r\n                        <p className=\"text-sm\">Please try again or use a different card.</p>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Header */}\r\n            <div>\r\n                <h1 className=\"text-2xl font-bold text-gray-900\">Billing & Subscription</h1>\r\n                <p className=\"mt-1 text-gray-500\">Manage your plan and payment details.</p>\r\n            </div>\r\n\r\n            {/* Current Status Card */}\r\n            <div className=\"bg-white shadow rounded-lg border border-gray-200 p-6\">\r\n                <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\r\n                    <div>\r\n                        <h3 className=\"text-lg font-medium text-gray-900 flex items-center gap-2\">\r\n                            Current Status:\r\n                            <span className={`px-2 py-1 rounded-full text-xs font-semibold uppercase ${subscriptionStatus === 'active' ? 'bg-green-100 text-green-800' :\r\n                                    subscriptionStatus === 'trial' ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800'\r\n                                }`}>\r\n                                {subscriptionStatus || 'Loading...'}\r\n                            </span>\r\n                        </h3>\r\n                        {trialEndsAt && subscriptionStatus === 'trial' && (\r\n                            <p className=\"mt-1 text-sm text-gray-500\">\r\n                                Your free trial ends on {new Date(trialEndsAt).toLocaleDateString()}\r\n                            </p>\r\n                        )}\r\n                        {!subscriptionStatus && <p className=\"text-sm text-gray-400\">Fetching subscription details...</p>}\r\n                    </div>\r\n                    {/* Add Manage Payment Method button if active */}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Pricing Section */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\r\n                {plans.map((plan) => (\r\n                    <PricingCard\r\n                        key={plan.id}\r\n                        plan={plan}\r\n                        currentPlanId={currentPlanId || undefined}\r\n                        onSelect={handleUpgrade}\r\n                        loading={loading}\r\n                    />\r\n                ))}\r\n            </div>\r\n\r\n            {/* Invoice History Placeholder */}\r\n            <div className=\"bg-white shadow rounded-lg border border-gray-200 overflow-hidden\">\r\n                <div className=\"px-6 py-4 border-b border-gray-200 bg-gray-50 flex items-center justify-between\">\r\n                    <h3 className=\"font-medium text-gray-900 flex items-center gap-2\">\r\n                        <History className=\"w-4 h-4 text-gray-500\" />\r\n                        Billing History\r\n                    </h3>\r\n                </div>\r\n                <div className=\"p-12 text-center text-gray-500\">\r\n                    <p>No invoices found.</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\documents\\page.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadDocuments` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\documents\\page.tsx:17:9\n  15 |\n  16 |     useEffect(() => {\n> 17 |         loadDocuments()\n     |         ^^^^^^^^^^^^^ `loadDocuments` accessed before it is declared\n  18 |     }, [currentFolder])\n  19 |\n  20 |     const loadDocuments = async () => {\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\documents\\page.tsx:20:5\n  18 |     }, [currentFolder])\n  19 |\n> 20 |     const loadDocuments = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 21 |         setLoading(true)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 22 |         const data = await getDocuments(currentFolder || undefined)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 23 |         setDocuments(data)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 24 |         setLoading(false)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 25 |     }\n     | ^^^^^^ `loadDocuments` is declared here\n  26 |\n  27 |     const handleDelete = async (doc: Document) => {\n  28 |         if (!confirm(`Are you sure you want to delete \"${doc.name}\"?`)) return","line":17,"column":9,"nodeType":null,"endLine":17,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { PageHeader } from '@/components/layout/PageHeader'\r\nimport { Upload, Search, Folder, File, MoreVertical, Download, Trash2, FileText, Image as ImageIcon } from 'lucide-react'\r\nimport { getDocuments, deleteDocument, getDocumentUrl, type Document } from '@/lib/database'\r\nimport { DocumentUpload } from '@/components/documents/DocumentUpload'\r\n\r\nexport default function DocumentsPage() {\r\n    const [documents, setDocuments] = useState<Document[]>([])\r\n    const [loading, setLoading] = useState(true)\r\n    const [searchTerm, setSearchTerm] = useState('')\r\n    const [currentFolder, setCurrentFolder] = useState<string | null>(null)\r\n    const [showUpload, setShowUpload] = useState(false)\r\n\r\n    useEffect(() => {\r\n        loadDocuments()\r\n    }, [currentFolder])\r\n\r\n    const loadDocuments = async () => {\r\n        setLoading(true)\r\n        const data = await getDocuments(currentFolder || undefined)\r\n        setDocuments(data)\r\n        setLoading(false)\r\n    }\r\n\r\n    const handleDelete = async (doc: Document) => {\r\n        if (!confirm(`Are you sure you want to delete \"${doc.name}\"?`)) return\r\n\r\n        const result = await deleteDocument(doc.id, doc.storage_path)\r\n        if (result.success) {\r\n            loadDocuments()\r\n        } else {\r\n            alert(`Error: ${result.error}`)\r\n        }\r\n    }\r\n\r\n    const handleDownload = (doc: Document) => {\r\n        const url = getDocumentUrl(doc.storage_path)\r\n        window.open(url, '_blank')\r\n    }\r\n\r\n    const filteredDocuments = documents.filter(doc =>\r\n        doc.name.toLowerCase().includes(searchTerm.toLowerCase())\r\n    )\r\n\r\n    const folders = ['General', 'Invoices', 'Receipts', 'Contracts', 'Bank Statements']\r\n\r\n    const getFileIcon = (type: string) => {\r\n        if (type.includes('image')) return <ImageIcon className=\"w-8 h-8 text-purple-500\" />\r\n        if (type.includes('pdf')) return <FileText className=\"w-8 h-8 text-red-500\" />\r\n        return <File className=\"w-8 h-8 text-blue-500\" />\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <PageHeader\r\n                title=\"Documents\"\r\n                description=\"Manage and organize your business documents\"\r\n                breadcrumbs={[\r\n                    { label: 'Dashboard', href: '/dashboard' },\r\n                    { label: 'Documents' }\r\n                ]}\r\n                action={\r\n                    <button\r\n                        onClick={() => setShowUpload(!showUpload)}\r\n                        className=\"px-4 py-2 rounded-md font-medium text-sm transition-colors duration-200 inline-flex items-center justify-center gap-2 bg-blue-600 text-white hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\"\r\n                    >\r\n                        <Upload className=\"w-4 h-4\" />\r\n                        <span>{showUpload ? 'Cancel Upload' : 'Upload File'}</span>\r\n                    </button>\r\n                }\r\n            />\r\n\r\n            <div className=\"bg-white rounded-lg border border-gray-200 shadow-sm\">\r\n                <div className=\"p-4 border-b border-gray-200 flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\r\n                    <div className=\"relative flex-1 max-w-md\">\r\n                        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Search documents...\"\r\n                            value={searchTerm}\r\n                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                            className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm\"\r\n                        />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2 overflow-x-auto pb-2 sm:pb-0\">\r\n                        <button\r\n                            onClick={() => setCurrentFolder(null)}\r\n                            className={`px-3 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${!currentFolder\r\n                                    ? 'bg-blue-100 text-blue-700'\r\n                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\r\n                                }`}\r\n                        >\r\n                            All Files\r\n                        </button>\r\n                        {folders.map(folder => (\r\n                            <button\r\n                                key={folder}\r\n                                onClick={() => setCurrentFolder(folder)}\r\n                                className={`px-3 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${currentFolder === folder\r\n                                        ? 'bg-blue-100 text-blue-700'\r\n                                        : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\r\n                                    }`}\r\n                            >\r\n                                {folder}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"p-6\">\r\n                    {showUpload && (\r\n                        <div className=\"mb-8 max-w-xl mx-auto\">\r\n                            <h3 className=\"text-lg font-medium text-gray-900 mb-4\">Upload Document</h3>\r\n                            <DocumentUpload\r\n                                folder={currentFolder || 'General'}\r\n                                onUploadComplete={() => {\r\n                                    setShowUpload(false)\r\n                                    loadDocuments()\r\n                                }}\r\n                            />\r\n                        </div>\r\n                    )}\r\n\r\n                    {loading ? (\r\n                        <div className=\"text-center py-12\">\r\n                            <div className=\"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto\"></div>\r\n                        </div>\r\n                    ) : filteredDocuments.length === 0 ? (\r\n                        <div className=\"text-center py-12 border-2 border-dashed border-gray-200 rounded-lg\">\r\n                            <div className=\"text-gray-400 mb-4\">\r\n                                <File className=\"w-12 h-12 mx-auto\" />\r\n                            </div>\r\n                            <p className=\"text-gray-500 mb-2\">No documents found</p>\r\n                            <p className=\"text-gray-400 text-sm\">Upload files to get started</p>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4\">\r\n                            {filteredDocuments.map((doc) => (\r\n                                <div key={doc.id} className=\"group relative bg-white p-4 rounded-lg border border-gray-200 hover:shadow-md transition-shadow\">\r\n                                    <div className=\"flex items-start justify-between mb-4\">\r\n                                        <div className=\"p-2 bg-gray-50 rounded-lg group-hover:bg-blue-50 transition-colors\">\r\n                                            {getFileIcon(doc.type)}\r\n                                        </div>\r\n                                        <div className=\"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                            <button\r\n                                                onClick={() => handleDownload(doc)}\r\n                                                className=\"p-1.5 text-gray-400 hover:text-blue-600 rounded hover:bg-blue-50\"\r\n                                                title=\"Download\"\r\n                                            >\r\n                                                <Download className=\"w-4 h-4\" />\r\n                                            </button>\r\n                                            <button\r\n                                                onClick={() => handleDelete(doc)}\r\n                                                className=\"p-1.5 text-gray-400 hover:text-red-600 rounded hover:bg-red-50\"\r\n                                                title=\"Delete\"\r\n                                            >\r\n                                                <Trash2 className=\"w-4 h-4\" />\r\n                                            </button>\r\n                                        </div>\r\n                                    </div>\r\n                                    <h3 className=\"text-sm font-medium text-gray-900 truncate mb-1\" title={doc.name}>\r\n                                        {doc.name}\r\n                                    </h3>\r\n                                    <div className=\"flex items-center justify-between text-xs text-gray-500\">\r\n                                        <span>{(doc.size / 1024).toFixed(1)} KB</span>\r\n                                        <span>{new Date(doc.created_at).toLocaleDateString()}</span>\r\n                                    </div>\r\n                                    {doc.entity_type && (\r\n                                        <div className=\"mt-2 pt-2 border-t border-gray-100\">\r\n                                            <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800\">\r\n                                                Linked to {doc.entity_type}\r\n                                            </span>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\documents\\scan\\page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":73,"column":62,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[3616,3748],"text":"\r\n                            Upload receipts and invoices - we&apos;ll extract the data automatically using AI\r\n                        "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[3616,3748],"text":"\r\n                            Upload receipts and invoices - we&lsquo;ll extract the data automatically using AI\r\n                        "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[3616,3748],"text":"\r\n                            Upload receipts and invoices - we&#39;ll extract the data automatically using AI\r\n                        "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[3616,3748],"text":"\r\n                            Upload receipts and invoices - we&rsquo;ll extract the data automatically using AI\r\n                        "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport Link from 'next/link'\r\nimport DocumentUploader from '@/components/documents/DocumentUploader'\r\nimport type { ExtractedData } from '@/lib/ocr'\r\nimport { createExpense } from '@/app/actions/expenses'\r\nimport { useState } from 'react'\r\n\r\nexport default function DocumentScannerPage() {\r\n    const [isSubmitting, setIsSubmitting] = useState(false)\r\n\r\n    const handleExtracted = async (data: ExtractedData) => {\r\n        setIsSubmitting(true)\r\n        try {\r\n            // Convert string amount to number if needed or ensure types match\r\n            const result = await createExpense({\r\n                description: data.vendor || 'Unknown Vendor',\r\n                amount: typeof data.amount === 'string' ? parseFloat(data.amount) : (data.amount || 0),\r\n                category: data.category || 'Uncategorized',\r\n                date: data.date || new Date().toISOString().split('T')[0],\r\n                vendor: data.vendor || null,\r\n                tax_rate: 0, // Default or extract if possible\r\n                tax_amount: typeof data.taxAmount === 'string' ? parseFloat(data.taxAmount) : (data.taxAmount || 0),\r\n                total_amount: typeof data.amount === 'string' ? parseFloat(data.amount) : (data.amount || 0),\r\n                status: 'pending'\r\n            })\r\n\r\n            if (result.success) {\r\n                alert('Expense created successfully!')\r\n            } else {\r\n                alert(`Failed to create expense: ${result.error}`)\r\n            }\r\n        } catch (error) {\r\n            console.error(error)\r\n            alert('An error occurred')\r\n        } finally {\r\n            setIsSubmitting(false)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50\">\r\n            {/* Header */}\r\n            <header className=\"bg-white border-b border-gray-200\">\r\n                <div className=\"px-8 py-4\">\r\n                    <h1 className=\"text-2xl font-bold text-gray-900\">TwineCapital</h1>\r\n                    <p className=\"text-gray-600\">Accounting, Intelligently Engineered</p>\r\n                </div>\r\n            </header>\r\n\r\n            {/* Navigation */}\r\n            <nav className=\"bg-white border-b border-gray-200\">\r\n                <div className=\"px-8 py-3 flex space-x-6\">\r\n                    <Link href=\"/dashboard\" className=\"text-gray-600 hover:text-gray-900\">Dashboard</Link>\r\n                    <Link href=\"/expenses\" className=\"text-gray-600 hover:text-gray-900\">Expenses</Link>\r\n                    <Link href=\"/invoices\" className=\"text-gray-600 hover:text-gray-900\">Invoices</Link>\r\n                    <span className=\"text-blue-600 font-medium border-b-2 border-blue-600 pb-1\">Document Scanner</span>\r\n                </div>\r\n            </nav>\r\n\r\n            {/* Main Content */}\r\n            <main className=\"p-8\">\r\n                <div className=\"max-w-6xl mx-auto\">\r\n                    {/* Page Header */}\r\n                    <div className=\"mb-8\">\r\n                        <div className=\"flex items-center gap-3 mb-2\">\r\n                            <svg className=\"w-8 h-8 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n                            </svg>\r\n                            <h2 className=\"text-3xl font-bold text-gray-900\">AI Document Scanner</h2>\r\n                        </div>\r\n                        <p className=\"text-gray-600 text-lg\">\r\n                            Upload receipts and invoices - we'll extract the data automatically using AI\r\n                        </p>\r\n                    </div>\r\n\r\n                    {/* Info Cards */}\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8\">\r\n                        <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <svg className=\"w-6 h-6 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 10V3L4 14h7v7l9-11h-7z\" />\r\n                                </svg>\r\n                                <div>\r\n                                    <p className=\"font-semibold text-blue-900\">Instant Extraction</p>\r\n                                    <p className=\"text-sm text-blue-700\">Vendor, date, amounts in seconds</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <svg className=\"w-6 h-6 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                                </svg>\r\n                                <div>\r\n                                    <p className=\"font-semibold text-green-900\">VAT Calculation</p>\r\n                                    <p className=\"text-sm text-green-700\">Automatic tax extraction</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"bg-purple-50 border border-purple-200 rounded-lg p-4\">\r\n                            <div className=\"flex items-center gap-3\">\r\n                                <svg className=\"w-6 h-6 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\" />\r\n                                </svg>\r\n                                <div>\r\n                                    <p className=\"font-semibold text-purple-900\">Auto-Categorize</p>\r\n                                    <p className=\"text-sm text-purple-700\">Smart expense categories</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Document Uploader */}\r\n                    <DocumentUploader onExtracted={handleExtracted} />\r\n\r\n                    {/* How it works */}\r\n                    <div className=\"mt-12 bg-white rounded-lg border border-gray-200 p-8\">\r\n                        <h3 className=\"text-xl font-semibold text-gray-900 mb-4\">How It Works</h3>\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\r\n                            <div className=\"text-center\">\r\n                                <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3\">\r\n                                    <span className=\"text-blue-600 font-bold text-lg\">1</span>\r\n                                </div>\r\n                                <h4 className=\"font-semibold text-gray-900 mb-1\">Upload</h4>\r\n                                <p className=\"text-sm text-gray-600\">Drag & drop or click to upload your receipt or invoice</p>\r\n                            </div>\r\n\r\n                            <div className=\"text-center\">\r\n                                <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3\">\r\n                                    <span className=\"text-blue-600 font-bold text-lg\">2</span>\r\n                                </div>\r\n                                <h4 className=\"font-semibold text-gray-900 mb-1\">Extract</h4>\r\n                                <p className=\"text-sm text-gray-600\">AI reads the document and extracts key information</p>\r\n                            </div>\r\n\r\n                            <div className=\"text-center\">\r\n                                <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3\">\r\n                                    <span className=\"text-blue-600 font-bold text-lg\">3</span>\r\n                                </div>\r\n                                <h4 className=\"font-semibold text-gray-900 mb-1\">Review</h4>\r\n                                <p className=\"text-sm text-gray-600\">Check the extracted data (or let high-confidence items auto-post)</p>\r\n                            </div>\r\n\r\n                            <div className=\"text-center\">\r\n                                <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3\">\r\n                                    <span className=\"text-blue-600 font-bold text-lg\">4</span>\r\n                                </div>\r\n                                <h4 className=\"font-semibold text-gray-900 mb-1\">Done</h4>\r\n                                <p className=\"text-sm text-gray-600\">Expense is created and categorized automatically</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </main>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\invoices\\[id]\\page.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadData` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\invoices\\[id]\\page.tsx:31:13\n  29 |     useEffect(() => {\n  30 |         if (id) {\n> 31 |             loadData()\n     |             ^^^^^^^^ `loadData` accessed before it is declared\n  32 |         }\n  33 |     }, [id])\n  34 |\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\invoices\\[id]\\page.tsx:35:5\n  33 |     }, [id])\n  34 |\n> 35 |     const loadData = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 36 |         setLoading(true)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 37 |         const invoiceData = await getInvoice(id)\n     ???\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 44 |         setLoading(false)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 45 |     }\n     | ^^^^^^ `loadData` is declared here\n  46 |\n  47 |     const formatCurrency = (amount: number) => {\n  48 |         return new Intl.NumberFormat('en-ZA', {","line":31,"column":13,"nodeType":null,"endLine":31,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { useParams } from 'next/navigation'\r\nimport Link from 'next/link'\r\nimport { ArrowLeft, Printer, Mail, MessageCircle } from 'lucide-react'\r\nimport { getInvoice, getClients, type Invoice, type Client } from '@/lib/database'\r\nimport { generateInvoiceMessage } from '@/lib/whatsapp'\r\nimport { WhatsAppModal } from '../whatsapp-modal'\r\nimport { PageHeader } from '@/components/layout/PageHeader'\r\nimport { AttachmentsList } from '@/components/documents/AttachmentsList'\r\nimport { SendInvoiceModal } from '@/components/email/SendInvoiceModal'\r\nimport { FollowUpEmailGenerator } from '@/components/email/FollowUpEmailGenerator'\r\nimport { InvoiceActions } from '@/components/invoice/InvoiceActions'\r\n\r\nexport default function InvoiceDetailsPage() {\r\n    const params = useParams()\r\n    const id = params?.id as string\r\n    const [invoice, setInvoice] = useState<Invoice | null>(null)\r\n    const [client, setClient] = useState<Client | null>(null)\r\n    const [loading, setLoading] = useState(true)\r\n    const [showSendModal, setShowSendModal] = useState(false)\r\n    const [generatedEmail, setGeneratedEmail] = useState<{ subject: string; body: string } | null>(null)\r\n\r\n    // WhatsApp State\r\n    const [showWhatsAppModal, setShowWhatsAppModal] = useState(false)\r\n    const [whatsAppMessage, setWhatsAppMessage] = useState('')\r\n\r\n    useEffect(() => {\r\n        if (id) {\r\n            loadData()\r\n        }\r\n    }, [id])\r\n\r\n    const loadData = async () => {\r\n        setLoading(true)\r\n        const invoiceData = await getInvoice(id)\r\n        if (invoiceData) {\r\n            setInvoice(invoiceData)\r\n            const clientsData = await getClients()\r\n            const clientData = clientsData.find(c => c.id === invoiceData.client_id)\r\n            setClient(clientData || null)\r\n        }\r\n        setLoading(false)\r\n    }\r\n\r\n    const formatCurrency = (amount: number) => {\r\n        return new Intl.NumberFormat('en-ZA', {\r\n            style: 'currency',\r\n            currency: 'ZAR'\r\n        }).format(amount)\r\n    }\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center min-h-[400px]\">\r\n                <div className=\"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin\"></div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    if (!invoice) {\r\n        return (\r\n            <div className=\"text-center py-12\">\r\n                <h2 className=\"text-2xl font-bold text-gray-900\">Invoice not found</h2>\r\n                <Link href=\"/invoices\" className=\"text-blue-600 hover:underline mt-4 inline-block\">\r\n                    Return to Invoices\r\n                </Link>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <PageHeader\r\n                title={`Invoice ${invoice.invoice_number}`}\r\n                description=\"View and manage invoice details\"\r\n                breadcrumbs={[\r\n                    { label: 'Dashboard', href: '/dashboard' },\r\n                    { label: 'Invoices', href: '/invoices' },\r\n                    { label: invoice.invoice_number }\r\n                ]}\r\n                action={\r\n                    <div className=\"flex gap-3\">\r\n                        <InvoiceActions invoice={invoice} onStatusChange={loadData} />\r\n                        <a\r\n                            href={`/api/invoices/${invoice.id}/pdf`}\r\n                            target=\"_blank\"\r\n                            rel=\"noopener noreferrer\"\r\n                            className=\"px-4 py-2 rounded-md font-medium text-sm transition-colors duration-200 inline-flex items-center justify-center gap-2 bg-white border border-gray-300 text-gray-700 hover:bg-gray-50\"\r\n                        >\r\n                            <Printer className=\"w-4 h-4\" />\r\n                            <span>Download PDF</span>\r\n                        </a>\r\n                        <button\r\n                            onClick={() => {\r\n                                if (invoice && client) {\r\n                                    setWhatsAppMessage(generateInvoiceMessage(invoice, client.name));\r\n                                    setShowWhatsAppModal(true);\r\n                                }\r\n                            }}\r\n                            className=\"px-4 py-2 rounded-md font-medium text-sm transition-colors duration-200 inline-flex items-center justify-center gap-2 bg-[#25D366] text-white hover:bg-[#128C7E]\"\r\n                        >\r\n                            <MessageCircle className=\"w-4 h-4\" />\r\n                            <span>WhatsApp</span>\r\n                        </button>\r\n                        <button\r\n                            onClick={() => setShowSendModal(true)}\r\n                            className=\"px-4 py-2 rounded-md font-medium text-sm transition-colors duration-200 inline-flex items-center justify-center gap-2 bg-blue-600 text-white hover:bg-blue-700\"\r\n                        >\r\n                            <Mail className=\"w-4 h-4\" />\r\n                            <span>Email</span>\r\n                        </button>\r\n                    </div>\r\n                }\r\n            />\r\n\r\n            {/* Send Invoice Modal */}\r\n            {showSendModal && (\r\n                <SendInvoiceModal\r\n                    invoiceId={invoice.id}\r\n                    invoiceNumber={invoice.invoice_number}\r\n                    defaultEmail={client?.email || ''}\r\n                    initialSubject={generatedEmail?.subject}\r\n                    initialBody={generatedEmail?.body}\r\n                    onClose={() => {\r\n                        setShowSendModal(false)\r\n                        setGeneratedEmail(null)\r\n                    }}\r\n                    onSuccess={() => {\r\n                        alert('Invoice sent successfully!')\r\n                        loadData()\r\n                    }}\r\n                />\r\n            )}\r\n\r\n            <WhatsAppModal\r\n                isOpen={showWhatsAppModal}\r\n                onClose={() => setShowWhatsAppModal(false)}\r\n                phoneNumber={client?.phone || ''}\r\n                clientName={client?.name || 'Client'}\r\n                message={whatsAppMessage}\r\n            />\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n                {/* Main Invoice Content */}\r\n                <div className=\"lg:col-span-2 space-y-6\">\r\n                    <div className=\"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden\">\r\n                        <div className=\"p-6 border-b border-gray-200 flex justify-between items-start\">\r\n                            <div>\r\n                                <h1 className=\"text-2xl font-bold text-gray-900\">INVOICE</h1>\r\n                                <p className=\"text-gray-500 mt-1\">#{invoice.invoice_number}</p>\r\n                            </div>\r\n                            <div className=\"text-right\">\r\n                                <div className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${invoice.status === 'paid' ? 'bg-green-100 text-green-800' :\r\n                                    invoice.status === 'sent' ? 'bg-blue-100 text-blue-800' :\r\n                                        invoice.status === 'overdue' ? 'bg-red-100 text-red-800' :\r\n                                            'bg-gray-100 text-gray-800'\r\n                                    }`}>\r\n                                    {invoice.status.toUpperCase()}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"p-6 grid grid-cols-2 gap-8\">\r\n                            <div>\r\n                                <h3 className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3\">Bill To</h3>\r\n                                {client ? (\r\n                                    <div className=\"text-sm text-gray-900\">\r\n                                        <p className=\"font-medium text-lg mb-1\">{client.name}</p>\r\n                                        {client.address && <p className=\"text-gray-600 whitespace-pre-line\">{client.address}</p>}\r\n                                        {client.email && <p className=\"text-gray-600 mt-1\">{client.email}</p>}\r\n                                    </div>\r\n                                ) : (\r\n                                    <p className=\"text-sm text-gray-500\">Unknown Client</p>\r\n                                )}\r\n                            </div>\r\n                            <div className=\"text-right\">\r\n                                <div className=\"space-y-2\">\r\n                                    <div>\r\n                                        <span className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\">Issue Date:</span>\r\n                                        <span className=\"ml-2 text-sm text-gray-900\">{new Date(invoice.issue_date).toLocaleDateString()}</span>\r\n                                    </div>\r\n                                    <div>\r\n                                        <span className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\">Due Date:</span>\r\n                                        <span className=\"ml-2 text-sm text-gray-900\">{new Date(invoice.due_date).toLocaleDateString()}</span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"p-6\">\r\n                            <table className=\"min-w-full divide-y divide-gray-200\">\r\n                                <thead>\r\n                                    <tr>\r\n                                        <th className=\"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Description</th>\r\n                                        <th className=\"px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">Qty</th>\r\n                                        <th className=\"px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">Price</th>\r\n                                        <th className=\"px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">Total</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody className=\"divide-y divide-gray-200\">\r\n                                    {invoice.items?.map((item, index) => (\r\n                                        <tr key={index}>\r\n                                            <td className=\"px-3 py-4 text-sm text-gray-900\">{item.description}</td>\r\n                                            <td className=\"px-3 py-4 text-sm text-gray-900 text-right\">{item.quantity}</td>\r\n                                            <td className=\"px-3 py-4 text-sm text-gray-900 text-right\">{formatCurrency(item.unit_price)}</td>\r\n                                            <td className=\"px-3 py-4 text-sm text-gray-900 text-right\">{formatCurrency(item.total_amount)}</td>\r\n                                        </tr>\r\n                                    ))}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n\r\n                        <div className=\"p-6 bg-gray-50 border-t border-gray-200\">\r\n                            <div className=\"flex justify-end\">\r\n                                <div className=\"w-64 space-y-3\">\r\n                                    <div className=\"flex justify-between text-sm text-gray-600\">\r\n                                        <span>Subtotal</span>\r\n                                        <span>{formatCurrency(invoice.total_amount - invoice.tax_amount)}</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between text-sm text-gray-600\">\r\n                                        <span>Tax</span>\r\n                                        <span>{formatCurrency(invoice.tax_amount)}</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between text-lg font-bold text-gray-900 border-t border-gray-200 pt-3\">\r\n                                        <span>Total</span>\r\n                                        <span>{formatCurrency(invoice.total_amount)}</span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {invoice.notes && (\r\n                            <div className=\"p-6 border-t border-gray-200\">\r\n                                <h3 className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2\">Notes</h3>\r\n                                <p className=\"text-sm text-gray-600\">{invoice.notes}</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Sidebar */}\r\n                <div className=\"space-y-6\">\r\n                    {/* AI Follow-up Generator */}\r\n                    <FollowUpEmailGenerator\r\n                        invoiceId={invoice.id}\r\n                        invoiceNumber={invoice.invoice_number}\r\n                        customerName={client?.name || 'Customer'}\r\n                        amount={invoice.total_amount}\r\n                        dueDate={invoice.due_date}\r\n                        onGenerate={(subject, body) => {\r\n                            setGeneratedEmail({ subject, body })\r\n                            setShowSendModal(true)\r\n                        }}\r\n                    />\r\n\r\n                    {/* Attachments */}\r\n                    <div className=\"bg-white rounded-lg border border-gray-200 shadow-sm p-6\">\r\n                        <AttachmentsList\r\n                            entityType=\"invoice\"\r\n                            entityId={invoice.id}\r\n                            folder=\"Invoices\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\invoices\\whatsapp-modal.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\invoices\\whatsapp-modal.tsx:21:9\n  19 |\n  20 |     useEffect(() => {\n> 21 |         setEditedMessage(message)\n     |         ^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  22 |         setEditedPhone(phoneNumber)\n  23 |     }, [message, phoneNumber])\n  24 |","line":21,"column":9,"nodeType":null,"endLine":21,"endColumn":25},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":63,"column":31,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[2554,2688],"text":"\r\n                            We&apos;ll automatically format this for WhatsApp (International format preferred).\r\n                        "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[2554,2688],"text":"\r\n                            We&lsquo;ll automatically format this for WhatsApp (International format preferred).\r\n                        "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[2554,2688],"text":"\r\n                            We&#39;ll automatically format this for WhatsApp (International format preferred).\r\n                        "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[2554,2688],"text":"\r\n                            We&rsquo;ll automatically format this for WhatsApp (International format preferred).\r\n                        "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":82,"column":38,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[3529,3688],"text":"\r\n                            Clicking &quot;Send\" will open WhatsApp Web or the WhatsApp App on your device with this pre-filled message.\r\n                        "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[3529,3688],"text":"\r\n                            Clicking &ldquo;Send\" will open WhatsApp Web or the WhatsApp App on your device with this pre-filled message.\r\n                        "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[3529,3688],"text":"\r\n                            Clicking &#34;Send\" will open WhatsApp Web or the WhatsApp App on your device with this pre-filled message.\r\n                        "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[3529,3688],"text":"\r\n                            Clicking &rdquo;Send\" will open WhatsApp Web or the WhatsApp App on your device with this pre-filled message.\r\n                        "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":82,"column":43,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[3529,3688],"text":"\r\n                            Clicking \"Send&quot; will open WhatsApp Web or the WhatsApp App on your device with this pre-filled message.\r\n                        "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[3529,3688],"text":"\r\n                            Clicking \"Send&ldquo; will open WhatsApp Web or the WhatsApp App on your device with this pre-filled message.\r\n                        "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[3529,3688],"text":"\r\n                            Clicking \"Send&#34; will open WhatsApp Web or the WhatsApp App on your device with this pre-filled message.\r\n                        "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[3529,3688],"text":"\r\n                            Clicking \"Send&rdquo; will open WhatsApp Web or the WhatsApp App on your device with this pre-filled message.\r\n                        "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { X, MessageCircle, ExternalLink } from 'lucide-react'\r\nimport { generateWhatsAppLink } from '@/lib/whatsapp'\r\n\r\ninterface WhatsAppModalProps {\r\n    isOpen: boolean\r\n    onClose: () => void\r\n    phoneNumber: string\r\n    message: string\r\n    clientName: string\r\n}\r\n\r\nexport function WhatsAppModal({ isOpen, onClose, phoneNumber, message, clientName }: WhatsAppModalProps) {\r\n    const [editedMessage, setEditedMessage] = useState(message)\r\n    const [editedPhone, setEditedPhone] = useState(phoneNumber)\r\n\r\n    useEffect(() => {\r\n        setEditedMessage(message)\r\n        setEditedPhone(phoneNumber)\r\n    }, [message, phoneNumber])\r\n\r\n    if (!isOpen) return null\r\n\r\n    const handleSend = () => {\r\n        if (!editedPhone) {\r\n            alert('Please enter a phone number')\r\n            return\r\n        }\r\n        const link = generateWhatsAppLink({ phone: editedPhone, message: editedMessage });\r\n        window.open(link, '_blank');\r\n        onClose();\r\n    }\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm\">\r\n            <div className=\"bg-white rounded-lg w-full max-w-md shadow-xl\">\r\n                <div className=\"p-4 border-b flex justify-between items-center bg-green-50 rounded-t-lg border-green-100\">\r\n                    <div className=\"flex items-center gap-2 text-green-700\">\r\n                        <MessageCircle className=\"w-5 h-5\" />\r\n                        <h3 className=\"font-semibold\">Send via WhatsApp</h3>\r\n                    </div>\r\n                    <button onClick={onClose} className=\"text-gray-400 hover:text-gray-600\">\r\n                        <X className=\"w-5 h-5\" />\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"p-6 space-y-4\">\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                            Client Phone Number\r\n                        </label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={editedPhone}\r\n                            onChange={(e) => setEditedPhone(e.target.value)}\r\n                            placeholder=\"e.g. 082 123 4567\"\r\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500\"\r\n                        />\r\n                        <p className=\"text-xs text-gray-500 mt-1\">\r\n                            We'll automatically format this for WhatsApp (International format preferred).\r\n                        </p>\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n                            Message\r\n                        </label>\r\n                        <textarea\r\n                            value={editedMessage}\r\n                            onChange={(e) => setEditedMessage(e.target.value)}\r\n                            rows={8}\r\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500 font-sans text-sm\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div className=\"bg-gray-50 p-3 rounded-md text-xs text-gray-500 flex gap-2\">\r\n                        <ExternalLink className=\"w-4 h-4 flex-shrink-0\" />\r\n                        <p>\r\n                            Clicking \"Send\" will open WhatsApp Web or the WhatsApp App on your device with this pre-filled message.\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"p-4 border-t bg-gray-50 rounded-b-lg flex justify-end gap-3\">\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"px-4 py-2 text-gray-700 font-medium hover:bg-gray-200 rounded-md transition-colors\"\r\n                    >\r\n                        Cancel\r\n                    </button>\r\n                    <button\r\n                        onClick={handleSend}\r\n                        className=\"px-4 py-2 bg-[#25D366] hover:bg-[#128C7E] text-white font-medium rounded-md flex items-center gap-2 transition-colors shadow-sm\"\r\n                    >\r\n                        <MessageCircle className=\"w-4 h-4\" />\r\n                        Send Message\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\marketplace\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\marketplace\\page.tsx:21:17\n  19 |         if (saved) {\n  20 |             try {\n> 21 |                 setInstalledApps(new Set(JSON.parse(saved)));\n     |                 ^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  22 |             } catch (e) {\n  23 |                 console.error('Failed to parse installed apps', e);\n  24 |                 // Default defaults","line":21,"column":17,"nodeType":null,"endLine":21,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n'use client'\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { PageHeader } from '@/components/layout/PageHeader';\r\nimport { MARKETPLACE_APPS, AppCategory, MarketplaceApp } from '@/lib/marketplace-data';\r\nimport { AppCard } from '@/components/marketplace/AppCard';\r\nimport { Search, Filter, LayoutGrid } from 'lucide-react';\r\n\r\nexport default function MarketplacePage() {\r\n    const [activeCategory, setActiveCategory] = useState<AppCategory | 'All'>('All');\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [installedApps, setInstalledApps] = useState<Set<string>>(new Set());\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // Load installed apps from localStorage on mount\r\n    useEffect(() => {\r\n        const saved = localStorage.getItem('marketplace_installed_apps');\r\n        if (saved) {\r\n            try {\r\n                setInstalledApps(new Set(JSON.parse(saved)));\r\n            } catch (e) {\r\n                console.error('Failed to parse installed apps', e);\r\n                // Default defaults\r\n                setInstalledApps(new Set(['ai_accountant', 'smart_invoicing', 'cashflow_engine', 'multi_currency']));\r\n            }\r\n        } else {\r\n            // Initialize defaults\r\n            const defaults = ['ai_accountant', 'smart_invoicing', 'cashflow_engine', 'multi_currency'];\r\n            setInstalledApps(new Set(defaults));\r\n            localStorage.setItem('marketplace_installed_apps', JSON.stringify(defaults));\r\n        }\r\n        setLoading(false);\r\n    }, []);\r\n\r\n    // Save changes to localStorage\r\n    const handleToggleInstall = (appId: string) => {\r\n        setInstalledApps(prev => {\r\n            const next = new Set(prev);\r\n            if (next.has(appId)) {\r\n                next.delete(appId);\r\n            } else {\r\n                next.add(appId);\r\n            }\r\n            localStorage.setItem('marketplace_installed_apps', JSON.stringify(Array.from(next)));\r\n            return next;\r\n        });\r\n    };\r\n\r\n    const filteredApps = MARKETPLACE_APPS.filter(app => {\r\n        const matchesCategory = activeCategory === 'All' || app.category === activeCategory;\r\n        const matchesSearch = app.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n            app.description.toLowerCase().includes(searchQuery.toLowerCase());\r\n        return matchesCategory && matchesSearch;\r\n    });\r\n\r\n    const categories: (AppCategory | 'All')[] = ['All', 'Finance', 'AI', 'Operations', 'Integrations'];\r\n\r\n    if (loading) {\r\n        return <div className=\"p-8 text-center text-gray-500\">Loading Marketplace...</div>;\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <PageHeader\r\n                title=\"App Marketplace\"\r\n                description=\"Discover and install add-ons to supercharge your business.\"\r\n                breadcrumbs={[\r\n                    { label: 'Dashboard', href: '/dashboard' },\r\n                    { label: 'Marketplace' }\r\n                ]}\r\n            />\r\n\r\n            <div className=\"mb-8 flex flex-col md:flex-row gap-4 items-center justify-between bg-white p-4 rounded-lg border border-gray-200 shadow-sm\">\r\n\r\n                {/* Search */}\r\n                <div className=\"relative w-full md:w-96\">\r\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-4 h-4\" />\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search for apps...\"\r\n                        value={searchQuery}\r\n                        onChange={(e) => setSearchQuery(e.target.value)}\r\n                        className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                    />\r\n                </div>\r\n\r\n                {/* Categories */}\r\n                <div className=\"flex items-center gap-2 overflow-x-auto w-full md:w-auto pb-2 md:pb-0\">\r\n                    {categories.map(cat => (\r\n                        <button\r\n                            key={cat}\r\n                            onClick={() => setActiveCategory(cat)}\r\n                            className={`px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap transition-colors ${activeCategory === cat\r\n                                    ? 'bg-blue-600 text-white'\r\n                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\r\n                                }`}\r\n                        >\r\n                            {cat}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6\">\r\n                {filteredApps.map(app => (\r\n                    <AppCard\r\n                        key={app.id}\r\n                        app={app}\r\n                        isInstalled={installedApps.has(app.id)}\r\n                        onToggleInstall={handleToggleInstall}\r\n                    />\r\n                ))}\r\n            </div>\r\n\r\n            {filteredApps.length === 0 && (\r\n                <div className=\"text-center py-12 bg-gray-50 rounded-lg border border-dashed border-gray-300\">\r\n                    <LayoutGrid className=\"w-12 h-12 text-gray-300 mx-auto mb-4\" />\r\n                    <h3 className=\"text-lg font-medium text-gray-900\">No apps found</h3>\r\n                    <p className=\"text-gray-500\">Try adjusting your search or category filter.</p>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\purchases\\bills\\[id]\\page.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadData` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\purchases\\bills\\[id]\\page.tsx:19:13\n  17 |     useEffect(() => {\n  18 |         if (id) {\n> 19 |             loadData()\n     |             ^^^^^^^^ `loadData` accessed before it is declared\n  20 |         }\n  21 |     }, [id])\n  22 |\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\purchases\\bills\\[id]\\page.tsx:23:5\n  21 |     }, [id])\n  22 |\n> 23 |     const loadData = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 24 |         setLoading(true)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 25 |         const billData = await getBill(id)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 26 |         if (billData) {\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 27 |             setBill(billData)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 28 |         }\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 29 |         setLoading(false)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 30 |     }\n     | ^^^^^^ `loadData` is declared here\n  31 |\n  32 |     const formatCurrency = (amount: number) => {\n  33 |         return new Intl.NumberFormat('en-ZA', {","line":19,"column":13,"nodeType":null,"endLine":19,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { useParams } from 'next/navigation'\r\nimport Link from 'next/link'\r\nimport { ArrowLeft, Printer, Mail } from 'lucide-react'\r\nimport { getBill, type Bill } from '@/lib/database'\r\nimport { PageHeader } from '@/components/layout/PageHeader'\r\nimport { AttachmentsList } from '@/components/documents/AttachmentsList'\r\n\r\nexport default function BillDetailsPage() {\r\n    const params = useParams()\r\n    const id = params?.id as string\r\n    const [bill, setBill] = useState<Bill | null>(null)\r\n    const [loading, setLoading] = useState(true)\r\n\r\n    useEffect(() => {\r\n        if (id) {\r\n            loadData()\r\n        }\r\n    }, [id])\r\n\r\n    const loadData = async () => {\r\n        setLoading(true)\r\n        const billData = await getBill(id)\r\n        if (billData) {\r\n            setBill(billData)\r\n        }\r\n        setLoading(false)\r\n    }\r\n\r\n    const formatCurrency = (amount: number) => {\r\n        return new Intl.NumberFormat('en-ZA', {\r\n            style: 'currency',\r\n            currency: 'ZAR'\r\n        }).format(amount)\r\n    }\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center min-h-[400px]\">\r\n                <div className=\"w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin\"></div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    if (!bill) {\r\n        return (\r\n            <div className=\"text-center py-12\">\r\n                <h2 className=\"text-2xl font-bold text-gray-900\">Bill not found</h2>\r\n                <Link href=\"/purchases/bills\" className=\"text-blue-600 hover:underline mt-4 inline-block\">\r\n                    Return to Bills\r\n                </Link>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <PageHeader\r\n                title={`Bill ${bill.bill_number}`}\r\n                description=\"View and manage bill details\"\r\n                breadcrumbs={[\r\n                    { label: 'Dashboard', href: '/dashboard' },\r\n                    { label: 'Purchases', href: '/purchases/bills' },\r\n                    { label: bill.bill_number }\r\n                ]}\r\n                action={\r\n                    <div className=\"flex gap-3\">\r\n                        <button className=\"px-4 py-2 rounded-md font-medium text-sm transition-colors duration-200 inline-flex items-center justify-center gap-2 bg-white border border-gray-300 text-gray-700 hover:bg-gray-50\">\r\n                            <Printer className=\"w-4 h-4\" />\r\n                            <span>Print</span>\r\n                        </button>\r\n                    </div>\r\n                }\r\n            />\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n                {/* Main Bill Content */}\r\n                <div className=\"lg:col-span-2 space-y-6\">\r\n                    <div className=\"bg-white rounded-lg border border-gray-200 shadow-sm overflow-hidden\">\r\n                        <div className=\"p-6 border-b border-gray-200 flex justify-between items-start\">\r\n                            <div>\r\n                                <h1 className=\"text-2xl font-bold text-gray-900\">BILL</h1>\r\n                                <p className=\"text-gray-500 mt-1\">#{bill.bill_number}</p>\r\n                            </div>\r\n                            <div className=\"text-right\">\r\n                                <div className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${bill.status === 'paid' ? 'bg-green-100 text-green-800' :\r\n                                    bill.status === 'overdue' ? 'bg-red-100 text-red-800' :\r\n                                        'bg-gray-100 text-gray-800'\r\n                                    }`}>\r\n                                    {bill.status.toUpperCase()}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"p-6 grid grid-cols-2 gap-8\">\r\n                            <div>\r\n                                <h3 className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3\">From</h3>\r\n                                <div className=\"text-sm text-gray-900\">\r\n                                    <p className=\"font-medium text-lg mb-1\">{bill.vendor_name}</p>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"text-right\">\r\n                                <div className=\"space-y-2\">\r\n                                    <div>\r\n                                        <span className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\">Bill Date:</span>\r\n                                        <span className=\"ml-2 text-sm text-gray-900\">{new Date(bill.bill_date).toLocaleDateString()}</span>\r\n                                    </div>\r\n                                    <div>\r\n                                        <span className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\">Due Date:</span>\r\n                                        <span className=\"ml-2 text-sm text-gray-900\">{new Date(bill.due_date).toLocaleDateString()}</span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"p-6\">\r\n                            <table className=\"min-w-full divide-y divide-gray-200\">\r\n                                <thead>\r\n                                    <tr>\r\n                                        <th className=\"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Description</th>\r\n                                        <th className=\"px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">Qty</th>\r\n                                        <th className=\"px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">Price</th>\r\n                                        <th className=\"px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">Total</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody className=\"divide-y divide-gray-200\">\r\n                                    {bill.items?.map((item, index) => (\r\n                                        <tr key={index}>\r\n                                            <td className=\"px-3 py-4 text-sm text-gray-900\">{item.description}</td>\r\n                                            <td className=\"px-3 py-4 text-sm text-gray-900 text-right\">{item.quantity}</td>\r\n                                            <td className=\"px-3 py-4 text-sm text-gray-900 text-right\">{formatCurrency(item.unit_price)}</td>\r\n                                            <td className=\"px-3 py-4 text-sm text-gray-900 text-right\">{formatCurrency(item.total_amount)}</td>\r\n                                        </tr>\r\n                                    ))}\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n\r\n                        <div className=\"p-6 bg-gray-50 border-t border-gray-200\">\r\n                            <div className=\"flex justify-end\">\r\n                                <div className=\"w-64 space-y-3\">\r\n                                    <div className=\"flex justify-between text-sm text-gray-600\">\r\n                                        <span>Subtotal</span>\r\n                                        <span>{formatCurrency(bill.total_amount - bill.tax_amount)}</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between text-sm text-gray-600\">\r\n                                        <span>Tax</span>\r\n                                        <span>{formatCurrency(bill.tax_amount)}</span>\r\n                                    </div>\r\n                                    <div className=\"flex justify-between text-lg font-bold text-gray-900 border-t border-gray-200 pt-3\">\r\n                                        <span>Total</span>\r\n                                        <span>{formatCurrency(bill.total_amount)}</span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {bill.notes && (\r\n                            <div className=\"p-6 border-t border-gray-200\">\r\n                                <h3 className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2\">Notes</h3>\r\n                                <p className=\"text-sm text-gray-600\">{bill.notes}</p>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Sidebar */}\r\n                <div className=\"space-y-6\">\r\n                    {/* Attachments */}\r\n                    <div className=\"bg-white rounded-lg border border-gray-200 shadow-sm p-6\">\r\n                        <AttachmentsList\r\n                            entityType=\"bill\"\r\n                            entityId={bill.id}\r\n                            folder=\"Bills\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\sales\\estimates\\page.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadEstimates` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\sales\\estimates\\page.tsx:17:9\n  15 |\n  16 |     useEffect(() => {\n> 17 |         loadEstimates()\n     |         ^^^^^^^^^^^^^ `loadEstimates` accessed before it is declared\n  18 |     }, [])\n  19 |\n  20 |     const loadEstimates = async () => {\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\sales\\estimates\\page.tsx:20:5\n  18 |     }, [])\n  19 |\n> 20 |     const loadEstimates = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 21 |         setLoading(true)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 22 |         const data = await getEstimates()\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 23 |         setEstimates(data)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 24 |         setLoading(false)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 25 |     }\n     | ^^^^^^ `loadEstimates` is declared here\n  26 |\n  27 |     const handleDelete = async (id: string) => {\n  28 |         if (!confirm('Are you sure you want to delete this estimate?')) return","line":17,"column":9,"nodeType":null,"endLine":17,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { PageHeader } from '@/components/layout/PageHeader'\r\nimport { EstimateForm } from '@/components/estimates/EstimateForm'\r\nimport { Plus, Search, Filter, Edit2, Trash2, Calendar, DollarSign, FileText } from 'lucide-react'\r\nimport { getEstimates, deleteEstimate, type Estimate } from '@/lib/database'\r\n\r\nexport default function EstimatesPage() {\r\n    const [estimates, setEstimates] = useState<Estimate[]>([])\r\n    const [loading, setLoading] = useState(true)\r\n    const [showForm, setShowForm] = useState(false)\r\n    const [editingEstimate, setEditingEstimate] = useState<Estimate | undefined>()\r\n    const [searchTerm, setSearchTerm] = useState('')\r\n\r\n    useEffect(() => {\r\n        loadEstimates()\r\n    }, [])\r\n\r\n    const loadEstimates = async () => {\r\n        setLoading(true)\r\n        const data = await getEstimates()\r\n        setEstimates(data)\r\n        setLoading(false)\r\n    }\r\n\r\n    const handleDelete = async (id: string) => {\r\n        if (!confirm('Are you sure you want to delete this estimate?')) return\r\n\r\n        const result = await deleteEstimate(id)\r\n        if (result.success) {\r\n            loadEstimates()\r\n        } else {\r\n            alert(`Error: ${result.error}`)\r\n        }\r\n    }\r\n\r\n    const filteredEstimates = estimates.filter(estimate =>\r\n        estimate.estimate_number.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        estimate.client?.name.toLowerCase().includes(searchTerm.toLowerCase())\r\n    )\r\n\r\n    const getStatusColor = (status: string) => {\r\n        switch (status) {\r\n            case 'draft': return 'bg-gray-100 text-gray-800'\r\n            case 'sent': return 'bg-blue-100 text-blue-800'\r\n            case 'accepted': return 'bg-green-100 text-green-800'\r\n            case 'rejected': return 'bg-red-100 text-red-800'\r\n            case 'expired': return 'bg-yellow-100 text-yellow-800'\r\n            default: return 'bg-gray-100 text-gray-800'\r\n        }\r\n    }\r\n\r\n    const formatCurrency = (amount: number) => {\r\n        return new Intl.NumberFormat('en-ZA', {\r\n            style: 'currency',\r\n            currency: 'ZAR'\r\n        }).format(amount)\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <PageHeader\r\n                title=\"Estimates\"\r\n                description=\"Create and manage quotes for your clients\"\r\n                breadcrumbs={[\r\n                    { label: 'Dashboard', href: '/dashboard' },\r\n                    { label: 'Sales' },\r\n                    { label: 'Estimates' }\r\n                ]}\r\n                action={\r\n                    <button\r\n                        onClick={() => {\r\n                            setEditingEstimate(undefined)\r\n                            setShowForm(true)\r\n                        }}\r\n                        className=\"px-4 py-2 rounded-md font-medium text-sm transition-colors duration-200 inline-flex items-center justify-center gap-2 bg-blue-600 text-white hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\"\r\n                    >\r\n                        <Plus className=\"w-4 h-4\" />\r\n                        <span>New Estimate</span>\r\n                    </button>\r\n                }\r\n            />\r\n\r\n            <div className=\"bg-white rounded-lg border border-gray-200 shadow-sm\">\r\n                <div className=\"p-4 border-b border-gray-200 flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\r\n                    <div className=\"relative flex-1 max-w-md\">\r\n                        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Search estimates...\"\r\n                            value={searchTerm}\r\n                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                            className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm\"\r\n                        />\r\n                    </div>\r\n                    <button className=\"px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 flex items-center gap-2\">\r\n                        <Filter className=\"w-4 h-4\" />\r\n                        <span>Filter</span>\r\n                    </button>\r\n                </div>\r\n\r\n                {loading ? (\r\n                    <div className=\"p-12 text-center\">\r\n                        <div className=\"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto\"></div>\r\n                    </div>\r\n                ) : filteredEstimates.length === 0 ? (\r\n                    <div className=\"p-12 text-center\">\r\n                        <div className=\"text-gray-400 mb-4\">\r\n                            <FileText className=\"w-16 h-16 mx-auto\" />\r\n                        </div>\r\n                        <p className=\"text-gray-500 mb-2 text-lg\">No estimates yet</p>\r\n                        <p className=\"text-gray-400 mb-6\">Create your first estimate to send to a client</p>\r\n                        <button\r\n                            onClick={() => {\r\n                                setEditingEstimate(undefined)\r\n                                setShowForm(true)\r\n                            }}\r\n                            className=\"px-4 py-2 rounded-md font-medium text-sm transition-colors duration-200 inline-flex items-center justify-center gap-2 bg-blue-600 text-white hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\"\r\n                        >\r\n                            <Plus className=\"w-4 h-4\" />\r\n                            <span>Create New Estimate</span>\r\n                        </button>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"divide-y divide-gray-200\">\r\n                        {filteredEstimates.map((estimate) => (\r\n                            <div key={estimate.id} className=\"p-6 hover:bg-gray-50 transition-colors\">\r\n                                <div className=\"flex items-start justify-between\">\r\n                                    <div className=\"flex-1\">\r\n                                        <div className=\"flex items-center gap-3 mb-2\">\r\n                                            <h3 className=\"text-lg font-semibold text-gray-900\">{estimate.estimate_number}</h3>\r\n                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(estimate.status)}`}>\r\n                                                {estimate.status.toUpperCase()}\r\n                                            </span>\r\n                                        </div>\r\n                                        <div className=\"mb-3\">\r\n                                            <p className=\"text-gray-900 font-medium\">{estimate.client?.name || 'Unknown Client'}</p>\r\n                                            {estimate.notes && <p className=\"text-sm text-gray-500 truncate max-w-md\">{estimate.notes}</p>}\r\n                                        </div>\r\n                                        <div className=\"flex flex-wrap gap-4 text-sm text-gray-500\">\r\n                                            <div className=\"flex items-center gap-1\">\r\n                                                <DollarSign className=\"w-4 h-4\" />\r\n                                                <span className=\"font-medium text-gray-900\">{formatCurrency(estimate.total_amount)}</span>\r\n                                            </div>\r\n                                            <div className=\"flex items-center gap-1\">\r\n                                                <Calendar className=\"w-4 h-4\" />\r\n                                                <span>Issued: {new Date(estimate.issue_date).toLocaleDateString()}</span>\r\n                                            </div>\r\n                                            {estimate.expiry_date && (\r\n                                                <div className=\"flex items-center gap-1\">\r\n                                                    <Calendar className=\"w-4 h-4\" />\r\n                                                    <span>Expires: {new Date(estimate.expiry_date).toLocaleDateString()}</span>\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"flex gap-2 ml-4\">\r\n                                        <button\r\n                                            onClick={() => {\r\n                                                setEditingEstimate(estimate)\r\n                                                setShowForm(true)\r\n                                            }}\r\n                                            className=\"p-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors\"\r\n                                        >\r\n                                            <Edit2 className=\"w-4 h-4\" />\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={() => handleDelete(estimate.id)}\r\n                                            className=\"p-2 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-md transition-colors\"\r\n                                        >\r\n                                            <Trash2 className=\"w-4 h-4\" />\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {showForm && (\r\n                <EstimateForm\r\n                    estimate={editingEstimate}\r\n                    onClose={() => {\r\n                        setShowForm(false)\r\n                        setEditingEstimate(undefined)\r\n                    }}\r\n                    onSuccess={loadEstimates}\r\n                />\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\time-tracking\\projects\\page.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadProjects` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\time-tracking\\projects\\page.tsx:19:9\n  17 |\n  18 |     useEffect(() => {\n> 19 |         loadProjects()\n     |         ^^^^^^^^^^^^ `loadProjects` accessed before it is declared\n  20 |     }, [])\n  21 |\n  22 |     const loadProjects = async () => {\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\time-tracking\\projects\\page.tsx:22:5\n  20 |     }, [])\n  21 |\n> 22 |     const loadProjects = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 23 |         setLoading(true)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 24 |         const data = await getProjects()\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 25 |         setProjects(data)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 26 |         setLoading(false)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 27 |     }\n     | ^^^^^^ `loadProjects` is declared here\n  28 |\n  29 |     const handleDelete = async (id: string) => {\n  30 |         if (!confirm('Are you sure you want to delete this project?')) return","line":19,"column":9,"nodeType":null,"endLine":19,"endColumn":21}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { PageHeader } from '@/components/layout/PageHeader'\r\nimport { ProjectForm } from '@/components/projects/ProjectForm'\r\nimport { Plus, Search, Filter, Edit2, Trash2, Calendar, DollarSign, Upload } from 'lucide-react'\r\nimport { getProjects, deleteProject, type Project } from '@/lib/database'\r\nimport { DocumentUpload } from '@/components/documents/DocumentUpload'\r\n\r\nexport default function ProjectsPage() {\r\n    const [projects, setProjects] = useState<Project[]>([])\r\n    const [loading, setLoading] = useState(true)\r\n    const [showForm, setShowForm] = useState(false)\r\n    const [editingProject, setEditingProject] = useState<Project | undefined>()\r\n    const [searchTerm, setSearchTerm] = useState('')\r\n    const [showUpload, setShowUpload] = useState(false)\r\n\r\n    useEffect(() => {\r\n        loadProjects()\r\n    }, [])\r\n\r\n    const loadProjects = async () => {\r\n        setLoading(true)\r\n        const data = await getProjects()\r\n        setProjects(data)\r\n        setLoading(false)\r\n    }\r\n\r\n    const handleDelete = async (id: string) => {\r\n        if (!confirm('Are you sure you want to delete this project?')) return\r\n\r\n        const result = await deleteProject(id)\r\n        if (result.success) {\r\n            loadProjects()\r\n        } else {\r\n            alert(`Error: ${result.error}`)\r\n        }\r\n    }\r\n\r\n    const filteredProjects = projects.filter(project =>\r\n        project.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        project.description?.toLowerCase().includes(searchTerm.toLowerCase())\r\n    )\r\n\r\n    const getStatusColor = (status: string) => {\r\n        switch (status) {\r\n            case 'active': return 'bg-green-100 text-green-800'\r\n            case 'on_hold': return 'bg-yellow-100 text-yellow-800'\r\n            case 'completed': return 'bg-blue-100 text-blue-800'\r\n            case 'cancelled': return 'bg-red-100 text-red-800'\r\n            default: return 'bg-gray-100 text-gray-800'\r\n        }\r\n    }\r\n\r\n    const formatCurrency = (amount: number | null) => {\r\n        if (!amount) return '-'\r\n        return new Intl.NumberFormat('en-ZA', {\r\n            style: 'currency',\r\n            currency: 'ZAR'\r\n        }).format(amount)\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <PageHeader\r\n                title=\"Projects\"\r\n                description=\"Manage your projects and tasks\"\r\n                breadcrumbs={[\r\n                    { label: 'Dashboard', href: '/dashboard' },\r\n                    { label: 'Time Tracking' },\r\n                    { label: 'Projects' }\r\n                ]}\r\n                action={\r\n                    <div className=\"flex gap-3\">\r\n                        <button\r\n                            onClick={() => setShowUpload(!showUpload)}\r\n                            className=\"px-4 py-2 rounded-md font-medium text-sm transition-colors duration-200 inline-flex items-center justify-center gap-2 bg-white border border-gray-300 text-gray-700 hover:bg-gray-50\"\r\n                        >\r\n                            <Upload className=\"w-4 h-4\" />\r\n                            <span>Upload Document</span>\r\n                        </button>\r\n                        <button\r\n                            onClick={() => {\r\n                                setEditingProject(undefined)\r\n                                setShowForm(true)\r\n                            }}\r\n                            className=\"px-4 py-2 rounded-md font-medium text-sm transition-colors duration-200 inline-flex items-center justify-center gap-2 bg-blue-600 text-white hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\"\r\n                        >\r\n                            <Plus className=\"w-4 h-4\" />\r\n                            <span>New Project</span>\r\n                        </button>\r\n                    </div>\r\n                }\r\n            />\r\n\r\n            {/* Upload Modal */}\r\n            {showUpload && (\r\n                <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n                    <div className=\"bg-white rounded-lg shadow-xl w-full max-w-md p-6\">\r\n                        <div className=\"flex items-center justify-between mb-4\">\r\n                            <h3 className=\"text-lg font-medium text-gray-900\">Upload Project Document</h3>\r\n                            <button\r\n                                onClick={() => setShowUpload(false)}\r\n                                className=\"text-gray-400 hover:text-gray-600\"\r\n                            >\r\n                                ???\r\n                            </button>\r\n                        </div>\r\n                        <DocumentUpload\r\n                            folder=\"Projects\"\r\n                            onUploadComplete={() => {\r\n                                setShowUpload(false)\r\n                            }}\r\n                        />\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            <div className=\"bg-white rounded-lg border border-gray-200 shadow-sm\">\r\n                <div className=\"p-4 border-b border-gray-200 flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\r\n                    <div className=\"relative flex-1 max-w-md\">\r\n                        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Search projects...\"\r\n                            value={searchTerm}\r\n                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                            className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm\"\r\n                        />\r\n                    </div>\r\n                    <button className=\"px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 flex items-center gap-2\">\r\n                        <Filter className=\"w-4 h-4\" />\r\n                        <span>Filter</span>\r\n                    </button>\r\n                </div>\r\n\r\n                {loading ? (\r\n                    <div className=\"p-12 text-center\">\r\n                        <div className=\"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto\"></div>\r\n                    </div>\r\n                ) : filteredProjects.length === 0 ? (\r\n                    <div className=\"p-12 text-center\">\r\n                        <div className=\"text-gray-400 mb-4\">\r\n                            <svg className=\"w-16 h-16 mx-auto\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1} d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\" />\r\n                            </svg>\r\n                        </div>\r\n                        <p className=\"text-gray-500 mb-2 text-lg\">No projects yet</p>\r\n                        <p className=\"text-gray-400 mb-6\">Create a project to track time and expenses</p>\r\n                        <button\r\n                            onClick={() => {\r\n                                setEditingProject(undefined)\r\n                                setShowForm(true)\r\n                            }}\r\n                            className=\"px-4 py-2 rounded-md font-medium text-sm transition-colors duration-200 inline-flex items-center justify-center gap-2 bg-blue-600 text-white hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\"\r\n                        >\r\n                            <Plus className=\"w-4 h-4\" />\r\n                            <span>Create New Project</span>\r\n                        </button>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"divide-y divide-gray-200\">\r\n                        {filteredProjects.map((project) => (\r\n                            <div key={project.id} className=\"p-6 hover:bg-gray-50 transition-colors\">\r\n                                <div className=\"flex items-start justify-between\">\r\n                                    <div className=\"flex-1\">\r\n                                        <div className=\"flex items-center gap-3 mb-2\">\r\n                                            <h3 className=\"text-lg font-semibold text-gray-900\">{project.name}</h3>\r\n                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(project.status)}`}>\r\n                                                {project.status.replace('_', ' ')}\r\n                                            </span>\r\n                                        </div>\r\n                                        {project.description && (\r\n                                            <p className=\"text-gray-600 mb-3\">{project.description}</p>\r\n                                        )}\r\n                                        <div className=\"flex flex-wrap gap-4 text-sm text-gray-500\">\r\n                                            {project.budget && (\r\n                                                <div className=\"flex items-center gap-1\">\r\n                                                    <DollarSign className=\"w-4 h-4\" />\r\n                                                    <span>{formatCurrency(project.budget)}</span>\r\n                                                </div>\r\n                                            )}\r\n                                            {project.start_date && (\r\n                                                <div className=\"flex items-center gap-1\">\r\n                                                    <Calendar className=\"w-4 h-4\" />\r\n                                                    <span>{new Date(project.start_date).toLocaleDateString()}</span>\r\n                                                    {project.end_date && (\r\n                                                        <span> - {new Date(project.end_date).toLocaleDateString()}</span>\r\n                                                    )}\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"flex gap-2 ml-4\">\r\n                                        <button\r\n                                            onClick={() => {\r\n                                                setEditingProject(project)\r\n                                                setShowForm(true)\r\n                                            }}\r\n                                            className=\"p-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors\"\r\n                                        >\r\n                                            <Edit2 className=\"w-4 h-4\" />\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={() => handleDelete(project.id)}\r\n                                            className=\"p-2 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-md transition-colors\"\r\n                                        >\r\n                                            <Trash2 className=\"w-4 h-4\" />\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {showForm && (\r\n                <ProjectForm\r\n                    project={editingProject}\r\n                    onClose={() => {\r\n                        setShowForm(false)\r\n                        setEditingProject(undefined)\r\n                    }}\r\n                    onSuccess={loadProjects}\r\n                />\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\time-tracking\\timesheets\\page.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadTimesheets` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\time-tracking\\timesheets\\page.tsx:17:9\n  15 |\n  16 |     useEffect(() => {\n> 17 |         loadTimesheets()\n     |         ^^^^^^^^^^^^^^ `loadTimesheets` accessed before it is declared\n  18 |     }, [])\n  19 |\n  20 |     const loadTimesheets = async () => {\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\(app)\\time-tracking\\timesheets\\page.tsx:20:5\n  18 |     }, [])\n  19 |\n> 20 |     const loadTimesheets = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 21 |         setLoading(true)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 22 |         const data = await getTimesheets()\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 23 |         setTimesheets(data)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 24 |         setLoading(false)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 25 |     }\n     | ^^^^^^ `loadTimesheets` is declared here\n  26 |\n  27 |     const handleDelete = async (id: string) => {\n  28 |         if (!confirm('Are you sure you want to delete this time entry?')) return","line":17,"column":9,"nodeType":null,"endLine":17,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { PageHeader } from '@/components/layout/PageHeader'\r\nimport { TimesheetForm } from '@/components/timesheets/TimesheetForm'\r\nimport { Plus, Search, Filter, Calendar, Clock, Edit2, Trash2 } from 'lucide-react'\r\nimport { getTimesheets, deleteTimesheet, type Timesheet } from '@/lib/database'\r\n\r\nexport default function TimesheetsPage() {\r\n    const [timesheets, setTimesheets] = useState<Timesheet[]>([])\r\n    const [loading, setLoading] = useState(true)\r\n    const [showForm, setShowForm] = useState(false)\r\n    const [editingTimesheet, setEditingTimesheet] = useState<Timesheet | undefined>()\r\n    const [searchTerm, setSearchTerm] = useState('')\r\n\r\n    useEffect(() => {\r\n        loadTimesheets()\r\n    }, [])\r\n\r\n    const loadTimesheets = async () => {\r\n        setLoading(true)\r\n        const data = await getTimesheets()\r\n        setTimesheets(data)\r\n        setLoading(false)\r\n    }\r\n\r\n    const handleDelete = async (id: string) => {\r\n        if (!confirm('Are you sure you want to delete this time entry?')) return\r\n\r\n        const result = await deleteTimesheet(id)\r\n        if (result.success) {\r\n            loadTimesheets()\r\n        } else {\r\n            alert(`Error: ${result.error}`)\r\n        }\r\n    }\r\n\r\n    const filteredTimesheets = timesheets.filter(entry =>\r\n        entry.description.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n        entry.project?.name.toLowerCase().includes(searchTerm.toLowerCase())\r\n    )\r\n\r\n    const getStatusColor = (status: string) => {\r\n        switch (status) {\r\n            case 'draft': return 'bg-gray-100 text-gray-800'\r\n            case 'submitted': return 'bg-blue-100 text-blue-800'\r\n            case 'approved': return 'bg-green-100 text-green-800'\r\n            case 'rejected': return 'bg-red-100 text-red-800'\r\n            default: return 'bg-gray-100 text-gray-800'\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div>\r\n            <PageHeader\r\n                title=\"Timesheets\"\r\n                description=\"Track time for your projects\"\r\n                breadcrumbs={[\r\n                    { label: 'Dashboard', href: '/dashboard' },\r\n                    { label: 'Time Tracking' },\r\n                    { label: 'Timesheets' }\r\n                ]}\r\n                action={\r\n                    <button\r\n                        onClick={() => {\r\n                            setEditingTimesheet(undefined)\r\n                            setShowForm(true)\r\n                        }}\r\n                        className=\"px-4 py-2 rounded-md font-medium text-sm transition-colors duration-200 inline-flex items-center justify-center gap-2 bg-blue-600 text-white hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\"\r\n                    >\r\n                        <Plus className=\"w-4 h-4\" />\r\n                        <span>Log Time</span>\r\n                    </button>\r\n                }\r\n            />\r\n\r\n            <div className=\"bg-white rounded-lg border border-gray-200 shadow-sm\">\r\n                <div className=\"p-4 border-b border-gray-200 flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\r\n                    <div className=\"relative flex-1 max-w-md\">\r\n                        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Search timesheets...\"\r\n                            value={searchTerm}\r\n                            onChange={(e) => setSearchTerm(e.target.value)}\r\n                            className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm\"\r\n                        />\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <button className=\"px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 flex items-center gap-2\">\r\n                            <Calendar className=\"w-4 h-4\" />\r\n                            <span>This Week</span>\r\n                        </button>\r\n                        <button className=\"px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 flex items-center gap-2\">\r\n                            <Filter className=\"w-4 h-4\" />\r\n                            <span>Filter</span>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {loading ? (\r\n                    <div className=\"p-12 text-center\">\r\n                        <div className=\"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto\"></div>\r\n                    </div>\r\n                ) : filteredTimesheets.length === 0 ? (\r\n                    <div className=\"p-12 text-center\">\r\n                        <div className=\"text-gray-400 mb-4\">\r\n                            <Clock className=\"w-16 h-16 mx-auto\" />\r\n                        </div>\r\n                        <p className=\"text-gray-500 mb-2 text-lg\">No time entries yet</p>\r\n                        <p className=\"text-gray-400 mb-6\">Start logging time for your projects</p>\r\n                        <button\r\n                            onClick={() => {\r\n                                setEditingTimesheet(undefined)\r\n                                setShowForm(true)\r\n                            }}\r\n                            className=\"px-4 py-2 rounded-md font-medium text-sm transition-colors duration-200 inline-flex items-center justify-center gap-2 bg-blue-600 text-white hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\"\r\n                        >\r\n                            <Plus className=\"w-4 h-4\" />\r\n                            <span>Log Time</span>\r\n                        </button>\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"divide-y divide-gray-200\">\r\n                        {filteredTimesheets.map((entry) => (\r\n                            <div key={entry.id} className=\"p-6 hover:bg-gray-50 transition-colors\">\r\n                                <div className=\"flex items-start justify-between\">\r\n                                    <div className=\"flex-1\">\r\n                                        <div className=\"flex items-center gap-3 mb-2\">\r\n                                            <h3 className=\"text-lg font-semibold text-gray-900\">\r\n                                                {entry.project?.name || 'No Project'}\r\n                                            </h3>\r\n                                            <span className={`px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(entry.status)}`}>\r\n                                                {entry.status.toUpperCase()}\r\n                                            </span>\r\n                                            {entry.billable && (\r\n                                                <span className=\"px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800\">\r\n                                                    BILLABLE\r\n                                                </span>\r\n                                            )}\r\n                                        </div>\r\n                                        <p className=\"text-gray-600 mb-2\">{entry.description}</p>\r\n                                        <div className=\"flex items-center gap-4 text-sm text-gray-500\">\r\n                                            <div className=\"flex items-center gap-1\">\r\n                                                <Calendar className=\"w-4 h-4\" />\r\n                                                <span>{new Date(entry.date).toLocaleDateString()}</span>\r\n                                            </div>\r\n                                            <div className=\"flex items-center gap-1\">\r\n                                                <Clock className=\"w-4 h-4\" />\r\n                                                <span>{entry.duration} hours</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"flex gap-2 ml-4\">\r\n                                        <button\r\n                                            onClick={() => {\r\n                                                setEditingTimesheet(entry)\r\n                                                setShowForm(true)\r\n                                            }}\r\n                                            className=\"p-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors\"\r\n                                        >\r\n                                            <Edit2 className=\"w-4 h-4\" />\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={() => handleDelete(entry.id)}\r\n                                            className=\"p-2 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-md transition-colors\"\r\n                                        >\r\n                                            <Trash2 className=\"w-4 h-4\" />\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {showForm && (\r\n                <TimesheetForm\r\n                    timesheet={editingTimesheet}\r\n                    onClose={() => {\r\n                        setShowForm(false)\r\n                        setEditingTimesheet(undefined)\r\n                    }}\r\n                    onSuccess={loadTimesheets}\r\n                />\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\api\\invoices\\[id]\\pdf\\route.ts","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":27,"column":9,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":27,"endColumn":70,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[1028,1089],"text":"// @ts-expect-error - renderToStream types might be tricky with RSC"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest, NextResponse } from 'next/server'\r\nimport { getInvoice, getClient } from '@/lib/database'\r\nimport { renderToStream } from '@react-pdf/renderer'\r\nimport { InvoicePDF } from '@/components/pdf/InvoicePDF'\r\nimport { createElement } from 'react'\r\n\r\nexport async function GET(\r\n    request: NextRequest,\r\n    { params }: { params: { id: string } }\r\n) {\r\n    try {\r\n        const id = params.id\r\n\r\n        // Get invoice data\r\n        const invoice = await getInvoice(id)\r\n        if (!invoice) {\r\n            return NextResponse.json({ error: 'Invoice not found' }, { status: 404 })\r\n        }\r\n\r\n        // Get client data\r\n        const client = invoice.client || (invoice.client_id ? await getClient(invoice.client_id) : undefined)\r\n\r\n        // Convert client to Client | undefined explicitly if needed, but the PDF component accepts Client | undefined\r\n        // Note: getClient returns Client | null, so we might need to handle null -> undefined or just rely on optional\r\n\r\n        // Render PDF\r\n        // @ts-ignore - renderToStream types might be tricky with RSC\r\n        const stream = await renderToStream(\r\n            createElement(InvoicePDF, {\r\n                invoice,\r\n                client: client || undefined,\r\n                items: invoice.items || [],\r\n                companyName: 'TwineCapital' // In real app, fetch from company settings\r\n            })\r\n        )\r\n\r\n        // Convert Node stream to Web Stream (Next.js Response expects Web Stream or similar)\r\n        // Actually NextResponse can take a Node stream in some versions, but standard Response takes a Web ReadableStream.\r\n        // @react-pdf/renderer renderToStream returns a Node.js Readable stream.\r\n\r\n        return new NextResponse(stream as any, {\r\n            headers: {\r\n                'Content-Type': 'application/pdf',\r\n                'Content-Disposition': `attachment; filename=\"invoice-${invoice.invoice_number}.pdf\"`,\r\n            },\r\n        })\r\n    } catch (error) {\r\n        console.error('Error generating PDF:', error)\r\n        // Return JSON error if something fails\r\n        return NextResponse.json(\r\n            { error: 'Failed to generate PDF: ' + (error instanceof Error ? error.message : String(error)) },\r\n            { status: 500 }\r\n        )\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\app\\login\\page.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":138,"column":18,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[5436,5474],"text":"\r\n              Don&apos;t have an account?"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[5436,5474],"text":"\r\n              Don&lsquo;t have an account?"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[5436,5474],"text":"\r\n              Don&#39;t have an account?"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[5436,5474],"text":"\r\n              Don&rsquo;t have an account?"},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState } from 'react'\r\nimport Link from 'next/link'\r\nimport { useRouter } from 'next/navigation'\r\nimport { Mail, Lock, ArrowRight, Loader2 } from 'lucide-react'\r\nimport { useToast } from '@/components/ui/toast'\r\n\r\nexport default function LoginPage() {\r\n  const [email, setEmail] = useState('')\r\n  const [password, setPassword] = useState('')\r\n  const [loading, setLoading] = useState(false)\r\n  const router = useRouter()\r\n  const toast = useToast()\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault()\r\n\r\n    if (!email || !password) {\r\n      toast.error('Missing fields', 'Please enter your email and password')\r\n      return\r\n    }\r\n\r\n    setLoading(true)\r\n\r\n    try {\r\n      const response = await fetch('/api/auth/login', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ email, password })\r\n      })\r\n\r\n      const data = await response.json()\r\n\r\n      if (!response.ok) {\r\n        throw new Error(data.error || 'Failed to sign in')\r\n      }\r\n\r\n      toast.success('Welcome back!', 'Redirecting to dashboard...')\r\n      setTimeout(() => router.push('/dashboard'), 1000)\r\n    } catch (error: any) {\r\n      console.error('Login error:', error)\r\n      toast.error('Sign-in failed', error.message)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-black flex items-center justify-center px-4\">\r\n      {/* Background gradients */}\r\n      <div className=\"absolute inset-0 pointer-events-none\">\r\n        <div className=\"absolute top-1/4 left-1/4 w-96 h-96 bg-blue-500/10 rounded-full blur-[128px]\" />\r\n        <div className=\"absolute bottom-1/4 right-1/4 w-96 h-96 bg-indigo-500/10 rounded-full blur-[128px]\" />\r\n      </div>\r\n\r\n      <div className=\"relative w-full max-w-md\">\r\n        {/* Logo */}\r\n        <Link href=\"/\" className=\"flex items-center justify-center gap-2 mb-8\">\r\n          <div className=\"w-10 h-10 rounded-lg bg-gradient-to-tr from-blue-500 to-indigo-500 flex items-center justify-center\">\r\n            <span className=\"text-white font-bold text-xl\">T</span>\r\n          </div>\r\n          <span className=\"text-white font-semibold text-2xl\">TwineCapital</span>\r\n        </Link>\r\n\r\n        {/* Form Card */}\r\n        <div className=\"bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl p-8 shadow-2xl\">\r\n          <div className=\"text-center mb-8\">\r\n            <h1 className=\"text-3xl font-bold text-white mb-2\">Welcome back</h1>\r\n            <p className=\"text-gray-400\">Sign in to your account</p>\r\n          </div>\r\n\r\n          <form onSubmit={handleSubmit} className=\"space-y-5\">\r\n            {/* Email */}\r\n            <div>\r\n              <label className=\"block text-sm font-medium text-gray-300 mb-2\">\r\n                Email Address\r\n              </label>\r\n              <div className=\"relative\">\r\n                <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\r\n                <input\r\n                  type=\"email\"\r\n                  value={email}\r\n                  onChange={(e) => setEmail(e.target.value)}\r\n                  placeholder=\"you@example.com\"\r\n                  className=\"w-full pl-11 pr-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                  required\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Password */}\r\n            <div>\r\n              <div className=\"flex items-center justify-between mb-2\">\r\n                <label className=\"block text-sm font-medium text-gray-300\">\r\n                  Password\r\n                </label>\r\n                <Link href=\"/forgot-password\" className=\"text-sm text-blue-400 hover:text-blue-300\">\r\n                  Forgot password?\r\n                </Link>\r\n              </div>\r\n              <div className=\"relative\">\r\n                <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\r\n                <input\r\n                  type=\"password\"\r\n                  value={password}\r\n                  onChange={(e) => setPassword(e.target.value)}\r\n                  placeholder=\"????????????????????????\"\r\n                  className=\"w-full pl-11 pr-4 py-3 bg-white/5 border border-white/10 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                  required\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Submit Button */}\r\n            <button\r\n              type=\"submit\"\r\n              disabled={loading}\r\n              className=\"w-full py-3 bg-white text-black font-semibold rounded-lg hover:bg-gray-100 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n            >\r\n              {loading ? (\r\n                <>\r\n                  <Loader2 className=\"w-5 h-5 animate-spin\" />\r\n                  Signing in...\r\n                </>\r\n              ) : (\r\n                <>\r\n                  Sign In\r\n                  <ArrowRight className=\"w-5 h-5\" />\r\n                </>\r\n              )}\r\n            </button>\r\n          </form>\r\n\r\n          {/* Sign Up Link */}\r\n          <div className=\"mt-6 text-center\">\r\n            <p className=\"text-gray-400 text-sm\">\r\n              Don't have an account?{' '}\r\n              <Link href=\"/signup\" className=\"text-blue-400 hover:text-blue-300 font-medium\">\r\n                Sign up\r\n              </Link>\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\components\\banking\\bank-connection-modal.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":89,"column":39,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[3928,4061],"text":"You&apos;ll be redirected to Stitch's secure platform to authorize access to your bank account. Your credentials are never shared with us."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[3928,4061],"text":"You&lsquo;ll be redirected to Stitch's secure platform to authorize access to your bank account. Your credentials are never shared with us."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[3928,4061],"text":"You&#39;ll be redirected to Stitch's secure platform to authorize access to your bank account. Your credentials are never shared with us."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[3928,4061],"text":"You&rsquo;ll be redirected to Stitch's secure platform to authorize access to your bank account. Your credentials are never shared with us."},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":89,"column":66,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[3928,4061],"text":"You'll be redirected to Stitch&apos;s secure platform to authorize access to your bank account. Your credentials are never shared with us."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[3928,4061],"text":"You'll be redirected to Stitch&lsquo;s secure platform to authorize access to your bank account. Your credentials are never shared with us."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[3928,4061],"text":"You'll be redirected to Stitch&#39;s secure platform to authorize access to your bank account. Your credentials are never shared with us."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[3928,4061],"text":"You'll be redirected to Stitch&rsquo;s secure platform to authorize access to your bank account. Your credentials are never shared with us."},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":122,"column":42,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[5981,6029],"text":"You&apos;ll be redirected to Stitch's secure platform"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[5981,6029],"text":"You&lsquo;ll be redirected to Stitch's secure platform"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[5981,6029],"text":"You&#39;ll be redirected to Stitch's secure platform"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[5981,6029],"text":"You&rsquo;ll be redirected to Stitch's secure platform"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":122,"column":69,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[5981,6029],"text":"You'll be redirected to Stitch&apos;s secure platform"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[5981,6029],"text":"You'll be redirected to Stitch&lsquo;s secure platform"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[5981,6029],"text":"You'll be redirected to Stitch&#39;s secure platform"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[5981,6029],"text":"You'll be redirected to Stitch&rsquo;s secure platform"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":134,"column":42,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[6827,6874],"text":"You&apos;ll be redirected back to complete the setup"},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[6827,6874],"text":"You&lsquo;ll be redirected back to complete the setup"},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[6827,6874],"text":"You&#39;ll be redirected back to complete the setup"},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[6827,6874],"text":"You&rsquo;ll be redirected back to complete the setup"},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":168,"column":176,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[8751,8820],"text":" - South Africa&apos;s leading Open Banking platform\r\n                    "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[8751,8820],"text":" - South Africa&lsquo;s leading Open Banking platform\r\n                    "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[8751,8820],"text":" - South Africa&#39;s leading Open Banking platform\r\n                    "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[8751,8820],"text":" - South Africa&rsquo;s leading Open Banking platform\r\n                    "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { X, Building2, AlertCircle, ExternalLink } from 'lucide-react'\r\n\r\ninterface BankConnectionModalProps {\r\n    onClose: () => void\r\n    onSuccess: () => void\r\n}\r\n\r\nconst SOUTH_AFRICAN_BANKS = [\r\n    { id: 'fnb', name: 'FNB (First National Bank)', color: 'bg-orange-600' },\r\n    { id: 'standard-bank', name: 'Standard Bank', color: 'bg-blue-700' },\r\n    { id: 'absa', name: 'ABSA', color: 'bg-red-600' },\r\n    { id: 'nedbank', name: 'Nedbank', color: 'bg-green-700' },\r\n    { id: 'capitec', name: 'Capitec Bank', color: 'bg-blue-500' }\r\n] as const\r\n\r\nexport function BankConnectionModal({\r\n    onClose,\r\n    onSuccess\r\n}: BankConnectionModalProps) {\r\n    const [loading, setLoading] = useState(false)\r\n    const [error, setError] = useState<string | null>(null)\r\n\r\n    const handleConnectBank = async () => {\r\n        try {\r\n            setLoading(true)\r\n            setError(null)\r\n\r\n            // Call initiate endpoint to get OAuth URL\r\n            const response = await fetch('/api/banking/connect/initiate')\r\n            const data = await response.json()\r\n\r\n            if (!response.ok) {\r\n                if (data.demoMode) {\r\n                    setError('Stitch API not configured. Please add STITCH_CLIENT_ID and STITCH_CLIENT_SECRET to your environment variables.')\r\n                    return\r\n                }\r\n                throw new Error(data.error || 'Failed to initiate connection')\r\n            }\r\n\r\n            // Redirect to Stitch OAuth page\r\n            window.location.href = data.authUrl\r\n        } catch (err) {\r\n            console.error('Error connecting bank:', err)\r\n            setError(err instanceof Error ? err.message : 'Failed to connect bank')\r\n            setLoading(false)\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm\">\r\n            <div className=\"bg-white rounded-lg w-full max-w-2xl shadow-xl max-h-[90vh] overflow-y-auto\">\r\n                <div className=\"p-6 border-b border-gray-200 flex justify-between items-center sticky top-0 bg-white z-10\">\r\n                    <div>\r\n                        <h3 className=\"text-xl font-semibold text-gray-900\">Connect Bank Account</h3>\r\n                        <p className=\"text-sm text-gray-500 mt-1\">\r\n                            Secure connection via Stitch Open Banking\r\n                        </p>\r\n                    </div>\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"text-gray-400 hover:text-gray-600 transition-colors\"\r\n                        disabled={loading}\r\n                    >\r\n                        <X className=\"w-5 h-5\" />\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"p-6\">\r\n                    {error && (\r\n                        <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n                            <div className=\"flex gap-3\">\r\n                                <AlertCircle className=\"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5\" />\r\n                                <div className=\"text-sm text-red-800\">\r\n                                    <p className=\"font-medium mb-1\">Connection Error</p>\r\n                                    <p>{error}</p>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"mb-6\">\r\n                        <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 flex gap-3\">\r\n                            <AlertCircle className=\"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5\" />\r\n                            <div className=\"text-sm text-blue-800\">\r\n                                <p className=\"font-medium mb-1\">Secure Connection</p>\r\n                                <p>You'll be redirected to Stitch's secure platform to authorize access to your bank account. Your credentials are never shared with us.</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"mb-6\">\r\n                        <h4 className=\"font-semibold text-gray-900 mb-3\">Supported Banks</h4>\r\n                        <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\r\n                            {SOUTH_AFRICAN_BANKS.map((bank) => (\r\n                                <div\r\n                                    key={bank.id}\r\n                                    className=\"p-4 border-2 border-gray-200 rounded-lg\"\r\n                                >\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                        <div className={`w-10 h-10 ${bank.color} rounded-lg flex items-center justify-center`}>\r\n                                            <Building2 className=\"w-5 h-5 text-white\" />\r\n                                        </div>\r\n                                        <div className=\"flex-1 min-w-0\">\r\n                                            <p className=\"font-medium text-gray-900 text-sm truncate\">\r\n                                                {bank.name.split('(')[0].trim()}\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"mb-6 p-4 bg-gray-50 rounded-lg\">\r\n                        <h4 className=\"font-semibold text-gray-900 mb-2 text-sm\">What happens next?</h4>\r\n                        <ol className=\"space-y-2 text-sm text-gray-600\">\r\n                            <li className=\"flex gap-2\">\r\n                                <span className=\"font-semibold text-blue-600\">1.</span>\r\n                                <span>You'll be redirected to Stitch's secure platform</span>\r\n                            </li>\r\n                            <li className=\"flex gap-2\">\r\n                                <span className=\"font-semibold text-blue-600\">2.</span>\r\n                                <span>Select your bank and log in with your banking credentials</span>\r\n                            </li>\r\n                            <li className=\"flex gap-2\">\r\n                                <span className=\"font-semibold text-blue-600\">3.</span>\r\n                                <span>Authorize TwineCapital to access your account information</span>\r\n                            </li>\r\n                            <li className=\"flex gap-2\">\r\n                                <span className=\"font-semibold text-blue-600\">4.</span>\r\n                                <span>You'll be redirected back to complete the setup</span>\r\n                            </li>\r\n                        </ol>\r\n                    </div>\r\n\r\n                    <div className=\"flex gap-3\">\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={onClose}\r\n                            className=\"flex-1 px-4 py-3 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors font-medium\"\r\n                            disabled={loading}\r\n                        >\r\n                            Cancel\r\n                        </button>\r\n                        <button\r\n                            onClick={handleConnectBank}\r\n                            disabled={loading}\r\n                            className=\"flex-1 px-4 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium inline-flex items-center justify-center gap-2\"\r\n                        >\r\n                            {loading ? (\r\n                                <>\r\n                                    <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\"></div>\r\n                                    <span>Connecting...</span>\r\n                                </>\r\n                            ) : (\r\n                                <>\r\n                                    <ExternalLink className=\"w-4 h-4\" />\r\n                                    <span>Connect via Stitch</span>\r\n                                </>\r\n                            )}\r\n                        </button>\r\n                    </div>\r\n\r\n                    <p className=\"mt-4 text-xs text-center text-gray-500\">\r\n                        Powered by <a href=\"https://stitch.money\" target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-600 hover:underline\">Stitch</a> - South Africa's leading Open Banking platform\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\components\\documents\\AttachmentsList.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`loadDocuments` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\components\\documents\\AttachmentsList.tsx:20:9\n  18 |\n  19 |     useEffect(() => {\n> 20 |         loadDocuments()\n     |         ^^^^^^^^^^^^^ `loadDocuments` accessed before it is declared\n  21 |     }, [entityType, entityId])\n  22 |\n  23 |     const loadDocuments = async () => {\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\components\\documents\\AttachmentsList.tsx:23:5\n  21 |     }, [entityType, entityId])\n  22 |\n> 23 |     const loadDocuments = async () => {\n     |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 24 |         setLoading(true)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 25 |         const data = await getDocuments(undefined, entityType, entityId)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 26 |         setDocuments(data)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 27 |         setLoading(false)\n     | ^^^^^^^^^^^^^^^^^^^^^^^^\n> 28 |     }\n     | ^^^^^^ `loadDocuments` is declared here\n  29 |\n  30 |     const handleDelete = async (doc: Document) => {\n  31 |         if (!confirm('Are you sure you want to delete this attachment?')) return","line":20,"column":9,"nodeType":null,"endLine":20,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { FileText, Download, Trash2, Paperclip } from 'lucide-react'\r\nimport { getDocuments, deleteDocument, getDocumentUrl, type Document } from '@/lib/database'\r\nimport { DocumentUpload } from './DocumentUpload'\r\n\r\ninterface AttachmentsListProps {\r\n    entityType: string\r\n    entityId: string\r\n    folder?: string\r\n}\r\n\r\nexport function AttachmentsList({ entityType, entityId, folder = 'General' }: AttachmentsListProps) {\r\n    const [documents, setDocuments] = useState<Document[]>([])\r\n    const [loading, setLoading] = useState(true)\r\n    const [showUpload, setShowUpload] = useState(false)\r\n\r\n    useEffect(() => {\r\n        loadDocuments()\r\n    }, [entityType, entityId])\r\n\r\n    const loadDocuments = async () => {\r\n        setLoading(true)\r\n        const data = await getDocuments(undefined, entityType, entityId)\r\n        setDocuments(data)\r\n        setLoading(false)\r\n    }\r\n\r\n    const handleDelete = async (doc: Document) => {\r\n        if (!confirm('Are you sure you want to delete this attachment?')) return\r\n\r\n        const result = await deleteDocument(doc.id, doc.storage_path)\r\n        if (result.success) {\r\n            loadDocuments()\r\n        } else {\r\n            alert(`Error: ${result.error}`)\r\n        }\r\n    }\r\n\r\n    const handleDownload = (doc: Document) => {\r\n        const url = getDocumentUrl(doc.storage_path)\r\n        window.open(url, '_blank')\r\n    }\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <h3 className=\"text-lg font-medium text-gray-900 flex items-center gap-2\">\r\n                    <Paperclip className=\"w-5 h-5 text-gray-500\" />\r\n                    Attachments\r\n                    <span className=\"text-sm font-normal text-gray-500\">({documents.length})</span>\r\n                </h3>\r\n                <button\r\n                    onClick={() => setShowUpload(!showUpload)}\r\n                    className=\"text-sm text-blue-600 hover:text-blue-700 font-medium\"\r\n                >\r\n                    {showUpload ? 'Cancel Upload' : 'Add Attachment'}\r\n                </button>\r\n            </div>\r\n\r\n            {showUpload && (\r\n                <div className=\"mb-4\">\r\n                    <DocumentUpload\r\n                        folder={folder}\r\n                        entityType={entityType}\r\n                        entityId={entityId}\r\n                        onUploadComplete={() => {\r\n                            setShowUpload(false)\r\n                            loadDocuments()\r\n                        }}\r\n                    />\r\n                </div>\r\n            )}\r\n\r\n            {loading ? (\r\n                <div className=\"text-center py-4 text-gray-500 text-sm\">Loading attachments...</div>\r\n            ) : documents.length === 0 ? (\r\n                <div className=\"text-center py-6 bg-gray-50 rounded-lg border border-dashed border-gray-200\">\r\n                    <p className=\"text-sm text-gray-500\">No attachments yet</p>\r\n                </div>\r\n            ) : (\r\n                <div className=\"grid grid-cols-1 gap-2\">\r\n                    {documents.map((doc) => (\r\n                        <div\r\n                            key={doc.id}\r\n                            className=\"flex items-center justify-between p-3 bg-white border border-gray-200 rounded-lg hover:shadow-sm transition-shadow\"\r\n                        >\r\n                            <div className=\"flex items-center gap-3 overflow-hidden\">\r\n                                <div className=\"p-2 bg-blue-50 text-blue-600 rounded-lg\">\r\n                                    <FileText className=\"w-5 h-5\" />\r\n                                </div>\r\n                                <div className=\"min-w-0\">\r\n                                    <p className=\"text-sm font-medium text-gray-900 truncate\">{doc.name}</p>\r\n                                    <p className=\"text-xs text-gray-500\">\r\n                                        {(doc.size / 1024).toFixed(1)} KB ??? {new Date(doc.created_at).toLocaleDateString()}\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-1\">\r\n                                <button\r\n                                    onClick={() => handleDownload(doc)}\r\n                                    className=\"p-1.5 text-gray-400 hover:text-gray-600 rounded-md hover:bg-gray-100\"\r\n                                    title=\"Download\"\r\n                                >\r\n                                    <Download className=\"w-4 h-4\" />\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => handleDelete(doc)}\r\n                                    className=\"p-1.5 text-gray-400 hover:text-red-600 rounded-md hover:bg-red-50\"\r\n                                    title=\"Delete\"\r\n                                >\r\n                                    <Trash2 className=\"w-4 h-4\" />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\components\\ui\\toast.tsx","messages":[{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Date.now` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\Tessl\\Documents\\TwineCapital\\web\\src\\components\\ui\\toast.tsx:30:95\n  28 |\n  29 |     const showToast = (type: ToastType, title: string, message?: string, duration = 5000) => {\n> 30 |         const id = typeof crypto !== 'undefined' && crypto.randomUUID ? crypto.randomUUID() : Date.now().toString()\n     |                                                                                               ^^^^^^^^^^ Cannot call impure function\n  31 |         const newToast: Toast = { id, type, title, message, duration }\n  32 |\n  33 |         setToasts((prev) => [...prev, newToast])","line":30,"column":95,"nodeType":null,"endLine":30,"endColumn":105}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\r\n\r\nimport { useState, useEffect, createContext, useContext, ReactNode } from 'react'\r\nimport { X, CheckCircle, AlertCircle, Info, AlertTriangle } from 'lucide-react'\r\n\r\ntype ToastType = 'success' | 'error' | 'warning' | 'info'\r\n\r\ninterface Toast {\r\n    id: string\r\n    type: ToastType\r\n    title: string\r\n    message?: string\r\n    duration?: number\r\n}\r\n\r\ninterface ToastContextType {\r\n    showToast: (type: ToastType, title: string, message?: string, duration?: number) => void\r\n    success: (title: string, message?: string) => void\r\n    error: (title: string, message?: string) => void\r\n    warning: (title: string, message?: string) => void\r\n    info: (title: string, message?: string) => void\r\n}\r\n\r\nconst ToastContext = createContext<ToastContextType | undefined>(undefined)\r\n\r\nexport function ToastProvider({ children }: { children: ReactNode }) {\r\n    const [toasts, setToasts] = useState<Toast[]>([])\r\n\r\n    const showToast = (type: ToastType, title: string, message?: string, duration = 5000) => {\r\n        const id = typeof crypto !== 'undefined' && crypto.randomUUID ? crypto.randomUUID() : Date.now().toString()\r\n        const newToast: Toast = { id, type, title, message, duration }\r\n\r\n        setToasts((prev) => [...prev, newToast])\r\n\r\n        if (duration > 0) {\r\n            setTimeout(() => {\r\n                removeToast(id)\r\n            }, duration)\r\n        }\r\n    }\r\n\r\n    const removeToast = (id: string) => {\r\n        setToasts((prev) => prev.filter((toast) => toast.id !== id))\r\n    }\r\n\r\n    const success = (title: string, message?: string) => showToast('success', title, message)\r\n    const error = (title: string, message?: string) => showToast('error', title, message)\r\n    const warning = (title: string, message?: string) => showToast('warning', title, message)\r\n    const info = (title: string, message?: string) => showToast('info', title, message)\r\n\r\n    return (\r\n        <ToastContext.Provider value={{ showToast, success, error, warning, info }}>\r\n            {children}\r\n            <div className=\"fixed bottom-4 right-4 z-50 flex flex-col gap-2 max-w-md\">\r\n                {toasts.map((toast) => (\r\n                    <ToastItem key={toast.id} toast={toast} onClose={() => removeToast(toast.id)} />\r\n                ))}\r\n            </div>\r\n        </ToastContext.Provider>\r\n    )\r\n}\r\n\r\nexport function useToast() {\r\n    const context = useContext(ToastContext)\r\n    if (!context) {\r\n        throw new Error('useToast must be used within ToastProvider')\r\n    }\r\n    return context\r\n}\r\n\r\nfunction ToastItem({ toast, onClose }: { toast: Toast; onClose: () => void }) {\r\n    const [isExiting, setIsExiting] = useState(false)\r\n\r\n    const handleClose = () => {\r\n        setIsExiting(true)\r\n        setTimeout(onClose, 200)\r\n    }\r\n\r\n    const icons = {\r\n        success: <CheckCircle className=\"w-5 h-5\" />,\r\n        error: <AlertCircle className=\"w-5 h-5\" />,\r\n        warning: <AlertTriangle className=\"w-5 h-5\" />,\r\n        info: <Info className=\"w-5 h-5\" />\r\n    }\r\n\r\n    const styles = {\r\n        success: 'bg-green-50 border-green-200 text-green-800',\r\n        error: 'bg-red-50 border-red-200 text-red-800',\r\n        warning: 'bg-yellow-50 border-yellow-200 text-yellow-800',\r\n        info: 'bg-blue-50 border-blue-200 text-blue-800'\r\n    }\r\n\r\n    const iconStyles = {\r\n        success: 'text-green-600',\r\n        error: 'text-red-600',\r\n        warning: 'text-yellow-600',\r\n        info: 'text-blue-600'\r\n    }\r\n\r\n    return (\r\n        <div\r\n            className={`\r\n        ${styles[toast.type]} \r\n        border rounded-lg p-4 shadow-lg\r\n        transition-all duration-200 ease-in-out\r\n        ${isExiting ? 'opacity-0 translate-x-full' : 'opacity-100 translate-x-0'}\r\n      `}\r\n        >\r\n            <div className=\"flex items-start gap-3\">\r\n                <div className={iconStyles[toast.type]}>\r\n                    {icons[toast.type]}\r\n                </div>\r\n                <div className=\"flex-1 min-w-0\">\r\n                    <p className=\"font-semibold text-sm\">{toast.title}</p>\r\n                    {toast.message && (\r\n                        <p className=\"text-sm mt-1 opacity-90\">{toast.message}</p>\r\n                    )}\r\n                </div>\r\n                <button\r\n                    onClick={handleClose}\r\n                    className=\"flex-shrink-0 hover:opacity-70 transition-opacity\"\r\n                >\r\n                    <X className=\"w-4 h-4\" />\r\n                </button>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]}]
